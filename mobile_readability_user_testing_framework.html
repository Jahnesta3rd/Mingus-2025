<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Readability User Testing Framework</title>
    <style>
        /* Mobile-First Typography System */
        :root {
            --font-size-xs: clamp(0.75rem, 2vw, 0.875rem);
            --font-size-sm: clamp(0.875rem, 2.5vw, 1rem);
            --font-size-base: clamp(1rem, 3vw, 1.125rem);
            --font-size-lg: clamp(1.125rem, 3.5vw, 1.25rem);
            --font-size-xl: clamp(1.25rem, 4vw, 1.5rem);
            --font-size-2xl: clamp(1.5rem, 5vw, 2rem);
            --font-size-3xl: clamp(2rem, 6vw, 2.5rem);
            
            --line-height-tight: 1.2;
            --line-height-normal: 1.4;
            --line-height-relaxed: 1.6;
            --line-height-loose: 1.8;
            
            --letter-spacing-tight: -0.025em;
            --letter-spacing-normal: 0;
            --letter-spacing-wide: 0.025em;
            --letter-spacing-wider: 0.05em;
            
            --space-xs: clamp(0.25rem, 1vw, 0.5rem);
            --space-sm: clamp(0.5rem, 1.5vw, 1vw);
            --space-md: clamp(0.75rem, 2vw, 1.25rem);
            --space-lg: clamp(1rem, 3vw, 1.5rem);
            --space-xl: clamp(1.5rem, 4vw, 2rem);
            --space-2xl: clamp(2rem, 5vw, 3rem);
            --space-3xl: clamp(3rem, 6vw, 4rem);
            
            --font-family-system: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-system);
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            letter-spacing: var(--letter-spacing-normal);
            color: #333;
            background: #fff;
            padding: var(--space-lg);
            transition: all 0.3s ease;
            min-width: 320px;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 0 15px;
        }

        .test-header {
            background: #f8f9fa;
            padding: clamp(15px, 4vw, 20px);
            border-radius: 8px;
            margin-bottom: clamp(20px, 5vw, 30px);
            text-align: center;
        }

        .test-header h1 {
            font-size: var(--font-size-4xl);
            line-height: var(--line-height-tight);
            letter-spacing: var(--letter-spacing-tight);
            margin-bottom: var(--space-md);
            font-weight: 700;
        }

        .test-header p {
            font-size: var(--font-size-lg);
            line-height: var(--line-height-relaxed);
            letter-spacing: var(--letter-spacing-wide);
            max-width: 800px;
            margin: 0 auto var(--space-md);
        }

        .test-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .test-card h2 {
            font-size: var(--font-size-2xl);
            line-height: var(--line-height-tight);
            letter-spacing: var(--letter-spacing-tight);
            margin-bottom: var(--space-md);
            font-weight: 600;
        }

        .test-card h3 {
            font-size: var(--font-size-xl);
            line-height: var(--line-height-normal);
            letter-spacing: var(--letter-spacing-normal);
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .test-section {
            margin-bottom: clamp(30px, 8vw, 40px);
        }

        .test-section h2 {
            color: #007bff;
            margin-bottom: clamp(12px, 3vw, 15px);
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            border-bottom: 2px solid #e9ecef;
            padding-bottom: clamp(6px, 2vw, 8px);
        }

        /* User Testing Controls */
        .testing-controls {
            background: #f8f9fa;
            padding: var(--space-lg);
            border-radius: 8px;
            margin-bottom: var(--space-lg);
            border: 2px solid #007bff;
        }

        .control-group {
            margin-bottom: var(--space-md);
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-xs);
            color: #333;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: var(--space-sm);
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: var(--font-size-base);
            min-height: 44px;
        }

        .testing-button {
            background: #007bff;
            color: #fff;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            font-size: var(--font-size-base);
            cursor: pointer;
            margin-right: var(--space-sm);
            margin-bottom: var(--space-sm);
            min-height: 44px;
        }

        .testing-button:hover {
            background: #0056b3;
        }

        .testing-button.secondary {
            background: #6c757d;
        }

        .testing-button.secondary:hover {
            background: #545b62;
        }

        /* A/B Testing Variants */
        .ab-test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin: var(--space-lg) 0;
        }

        .ab-variant {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: var(--space-lg);
            background: #fff;
        }

        .ab-variant.active {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
        }

        .variant-label {
            background: #007bff;
            color: #fff;
            padding: var(--space-xs) var(--space-sm);
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin-bottom: var(--space-md);
            display: inline-block;
        }

        /* Vision Testing Simulator */
        .vision-simulator {
            background: #f8f9fa;
            padding: var(--space-lg);
            border-radius: 8px;
            margin: var(--space-lg) 0;
        }

        .vision-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .vision-preset {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: var(--space-sm);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .vision-preset:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }

        .vision-preset.active {
            border-color: #007bff;
            background: #e3f2fd;
        }

        /* Sunglasses Testing */
        .sunglasses-test {
            background: linear-gradient(135deg, #fff9c4, #fff59d);
            padding: var(--space-lg);
            border-radius: 8px;
            margin: var(--space-lg) 0;
            border: 2px solid #ffc107;
        }

        .sunglasses-toggle {
            background: #ffc107;
            color: #333;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            margin-bottom: var(--space-md);
        }

        .sunglasses-active {
            filter: brightness(0.7) contrast(1.2) saturate(0.8);
        }

        /* Task Completion Tracking */
        .task-tracker {
            background: #e8f5e8;
            padding: var(--space-lg);
            border-radius: 8px;
            margin: var(--space-lg) 0;
            border: 2px solid #28a745;
        }

        .task-item {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-sm);
            padding: var(--space-sm);
            background: #fff;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .task-checkbox {
            margin-right: var(--space-sm);
            transform: scale(1.2);
        }

        .task-text {
            flex: 1;
            font-size: var(--font-size-base);
        }

        .task-time {
            color: #666;
            font-size: var(--font-size-sm);
        }

        /* Feedback Collection */
        .feedback-form {
            background: #fff3cd;
            padding: var(--space-lg);
            border-radius: 8px;
            margin: var(--space-lg) 0;
            border: 2px solid #ffc107;
        }

        .feedback-question {
            margin-bottom: var(--space-md);
        }

        .feedback-question label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-xs);
            color: #333;
        }

        .feedback-question textarea {
            width: 100%;
            padding: var(--space-sm);
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: var(--font-size-base);
            min-height: 100px;
            resize: vertical;
        }

        .rating-scale {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-xs);
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .rating-option input {
            margin-bottom: var(--space-xs);
        }

        .rating-label {
            font-size: var(--font-size-sm);
            text-align: center;
        }

        /* Test Content Samples */
        .test-content {
            margin: var(--space-lg) 0;
        }

        .content-sample {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
        }

        .content-sample h4 {
            color: #007bff;
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-lg);
        }

        .difficulty-indicator {
            display: inline-block;
            padding: var(--space-xs) var(--space-sm);
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin-left: var(--space-sm);
        }

        .difficulty-easy { background: #d4edda; color: #155724; }
        .difficulty-medium { background: #fff3cd; color: #856404; }
        .difficulty-hard { background: #f8d7da; color: #721c24; }

        /* Results Dashboard */
        .results-dashboard {
            background: #f8f9fa;
            padding: var(--space-lg);
            border-radius: 8px;
            margin: var(--space-lg) 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-md);
        }

        .result-card {
            background: #fff;
            padding: var(--space-md);
            border-radius: 4px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .result-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: #007bff;
            margin-bottom: var(--space-xs);
        }

        .result-label {
            font-size: var(--font-size-sm);
            color: #666;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .ab-test-container {
                grid-template-columns: 1fr;
            }
            
            .vision-controls {
                grid-template-columns: 1fr;
            }
            
            .rating-scale {
                flex-wrap: wrap;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #e0e0e0;
            }
            
            .test-card {
                background: #2d2d2d;
                border-color: #444;
            }
            
            .testing-controls,
            .vision-simulator,
            .task-tracker,
            .feedback-form,
            .results-dashboard {
                background: #3d3d3d;
                border-color: #555;
            }
            
            .content-sample {
                background: #2d2d2d;
                border-color: #444;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-header">
            <h1>Mobile Readability User Testing Framework</h1>
            <p>Comprehensive testing framework for African American professionals 25-35 with focus on vision abilities, device preferences, and real-world usage scenarios including sunglasses testing.</p>
        </div>

        <!-- Testing Controls -->
        <div class="testing-controls">
            <h3>Testing Configuration</h3>
            <div class="control-group">
                <label for="participant-id">Participant ID:</label>
                <input type="text" id="participant-id" placeholder="Enter participant identifier" class="form-input">
            </div>
            
            <div class="control-group">
                <label for="device-type">Device Type:</label>
                <select id="device-type" class="form-input">
                    <option value="">Select device</option>
                    <option value="iphone">iPhone</option>
                    <option value="android">Android</option>
                    <option value="tablet">Tablet</option>
                    <option value="desktop">Desktop</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="vision-ability">Vision Ability:</label>
                <select id="vision-ability" class="form-input">
                    <option value="">Select vision ability</option>
                    <option value="normal">Normal vision</option>
                    <option value="corrected">Corrected vision (glasses/contacts)</option>
                    <option value="colorblind">Color vision deficiency</option>
                    <option value="low-vision">Low vision</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="lighting-condition">Lighting Condition:</label>
                <select id="lighting-condition" class="form-input">
                    <option value="">Select lighting</option>
                    <option value="indoor">Indoor lighting</option>
                    <option value="outdoor-bright">Outdoor bright sunlight</option>
                    <option value="outdoor-overcast">Outdoor overcast</option>
                    <option value="low-light">Low light</option>
                </select>
            </div>
            
            <button class="testing-button" onclick="startTest()">Start Test Session</button>
            <button class="testing-button secondary" onclick="resetTest()">Reset Test</button>
        </div>

        <!-- A/B Testing Section -->
        <div class="test-section">
            <h2>A/B Testing - Typography Variants</h2>
            <p>Compare different typography approaches to determine which provides better readability for your target audience.</p>
            
            <div class="ab-test-container">
                <div class="ab-variant" id="variant-a">
                    <div class="variant-label">Variant A - Standard System Font</div>
                    <div class="content-sample">
                        <h4>Financial Planning for Young Professionals</h4>
                        <p>Building wealth in your 20s and 30s requires strategic planning and disciplined saving. Start by creating an emergency fund covering 3-6 months of expenses, then focus on retirement contributions and debt elimination.</p>
                        <p>Consider investing in index funds for long-term growth, and don't forget to protect your income with disability insurance. Regular financial check-ins help you stay on track toward your goals.</p>
                    </div>
                    <button class="testing-button" onclick="rateVariant('A')">Rate This Variant</button>
                </div>
                
                <div class="ab-variant" id="variant-b">
                    <div class="variant-label">Variant B - Enhanced Readability</div>
                    <div class="content-sample" style="font-size: 1.1em; line-height: 1.7; letter-spacing: 0.02em;">
                        <h4>Financial Planning for Young Professionals</h4>
                        <p>Building wealth in your 20s and 30s requires strategic planning and disciplined saving. Start by creating an emergency fund covering 3-6 months of expenses, then focus on retirement contributions and debt elimination.</p>
                        <p>Consider investing in index funds for long-term growth, and don't forget to protect your income with disability insurance. Regular financial check-ins help you stay on track toward your goals.</p>
                    </div>
                    <button class="testing-button" onclick="rateVariant('B')">Rate This Variant</button>
                </div>
            </div>
        </div>

        <!-- Vision Testing Simulator -->
        <div class="test-section">
            <h2>Vision Ability Testing</h2>
            <p>Simulate different vision conditions to test readability across various user abilities.</p>
            
            <div class="vision-simulator">
                <h3>Vision Condition Simulator</h3>
                <div class="vision-controls">
                    <div class="vision-preset" onclick="applyVisionFilter('normal')">
                        <strong>Normal Vision</strong><br>
                        <small>Standard display</small>
                    </div>
                    <div class="vision-preset" onclick="applyVisionFilter('colorblind')">
                        <strong>Color Vision Deficiency</strong><br>
                        <small>Reduced color perception</small>
                    </div>
                    <div class="vision-preset" onclick="applyVisionFilter('low-contrast')">
                        <strong>Low Contrast Sensitivity</strong><br>
                        <small>Reduced contrast perception</small>
                    </div>
                    <div class="vision-preset" onclick="applyVisionFilter('blur')">
                        <strong>Blurred Vision</strong><br>
                        <small>Simulated focus issues</small>
                    </div>
                </div>
                
                <div class="content-sample" id="vision-test-content">
                    <h4>Healthcare Benefits Overview</h4>
                    <p>Your employer-sponsored health plan includes comprehensive coverage for medical, dental, and vision care. The plan features a $500 deductible and 80/20 coinsurance after deductible is met.</p>
                    <p>Preventive care services are covered at 100% with no deductible. You can choose from a network of over 5,000 healthcare providers in your area. Prescription drug coverage includes both generic and brand-name medications.</p>
                </div>
            </div>
        </div>

        <!-- Sunglasses Testing -->
        <div class="test-section">
            <h2>Sunglasses Readability Testing</h2>
            <p>Test readability while wearing sunglasses - a common mobile usage scenario outdoors.</p>
            
            <div class="sunglasses-test">
                <button class="sunglasses-toggle" onclick="toggleSunglasses()">Toggle Sunglasses Simulation</button>
                <div class="content-sample" id="sunglasses-content">
                    <h4>Outdoor Event Information</h4>
                    <p>Join us for our annual networking event at Central Park on Saturday, June 15th from 2:00 PM to 6:00 PM. The event will feature keynote speakers, networking sessions, and refreshments.</p>
                    <p>Please bring business cards and dress appropriately for outdoor weather. In case of rain, the event will be moved to the indoor venue at 123 Business Center. RSVP by June 10th to secure your spot.</p>
                </div>
            </div>
        </div>

        <!-- Task Completion Tracking -->
        <div class="test-section">
            <h2>Task Completion Testing</h2>
            <p>Track completion rates and time for specific reading tasks to measure readability effectiveness.</p>
            
            <div class="task-tracker">
                <h3>Reading Comprehension Tasks</h3>
                <div class="task-item">
                    <input type="checkbox" class="task-checkbox" id="task1">
                    <div class="task-text">Read and understand the financial planning content</div>
                    <div class="task-time" id="time1">--:--</div>
                </div>
                <div class="task-item">
                    <input type="checkbox" class="task-checkbox" id="task2">
                    <div class="task-text">Identify key healthcare benefits from the overview</div>
                    <div class="task-time" id="time2">--:--</div>
                </div>
                <div class="task-item">
                    <input type="checkbox" class="task-checkbox" id="task3">
                    <div class="task-text">Extract event details from outdoor information</div>
                    <div class="task-time" id="time3">--:--</div>
                </div>
                
                <button class="testing-button" onclick="startTaskTimer()">Start Task Timer</button>
                <button class="testing-button secondary" onclick="completeTask()">Mark Task Complete</button>
            </div>
        </div>

        <!-- Feedback Collection -->
        <div class="test-section">
            <h2>User Feedback Collection</h2>
            <p>Collect detailed feedback on readability issues and user experience.</p>
            
            <div class="feedback-form">
                <div class="feedback-question">
                    <label>Overall readability rating:</label>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="readability" value="1">
                            <div class="rating-label">1<br>Very Poor</div>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="readability" value="2">
                            <div class="rating-label">2<br>Poor</div>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="readability" value="3">
                            <div class="rating-label">3<br>Fair</div>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="readability" value="4">
                            <div class="rating-label">4<br>Good</div>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="readability" value="5">
                            <div class="rating-label">5<br>Excellent</div>
                        </div>
                    </div>
                </div>
                
                <div class="feedback-question">
                    <label>Which text elements caused the most difficulty?</label>
                    <textarea placeholder="Describe any text elements that were hard to read..." class="form-input"></textarea>
                </div>
                
                <div class="feedback-question">
                    <label>How did wearing sunglasses affect your reading experience?</label>
                    <textarea placeholder="Describe the impact of sunglasses on readability..." class="form-input"></textarea>
                </div>
                
                <div class="feedback-question">
                    <label>What would improve the readability for you?</label>
                    <textarea placeholder="Suggest specific improvements..." class="form-input"></textarea>
                </div>
                
                <button class="testing-button" onclick="submitFeedback()">Submit Feedback</button>
            </div>
        </div>

        <!-- Results Dashboard -->
        <div class="test-section">
            <h2>Test Results Dashboard</h2>
            <p>Real-time tracking of test metrics and user performance.</p>
            
            <div class="results-dashboard">
                <h3>Session Metrics</h3>
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-value" id="completion-rate">0%</div>
                        <div class="result-label">Task Completion Rate</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="avg-time">0:00</div>
                        <div class="result-label">Average Task Time</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="readability-score">0.0</div>
                        <div class="result-label">Readability Score</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="variant-preference">-</div>
                        <div class="result-label">Preferred Variant</div>
                    </div>
                </div>
                
                <button class="testing-button" onclick="exportResults()">Export Results</button>
                <button class="testing-button secondary" onclick="generateReport()">Generate Report</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables for tracking
        let testStartTime = null;
        let taskStartTime = null;
        let currentTask = 0;
        let variantRatings = { A: 0, B: 0 };
        let taskTimes = [];
        let feedbackData = {};

        // Initialize test session
        function startTest() {
            const participantId = document.getElementById('participant-id').value;
            if (!participantId) {
                alert('Please enter a participant ID');
                return;
            }
            
            testStartTime = new Date();
            alert('Test session started for participant: ' + participantId);
            
            // Enable all interactive elements
            document.querySelectorAll('.testing-button').forEach(btn => btn.disabled = false);
        }

        // Reset test session
        function resetTest() {
            if (confirm('Are you sure you want to reset the test session?')) {
                testStartTime = null;
                taskStartTime = null;
                currentTask = 0;
                variantRatings = { A: 0, B: 0 };
                taskTimes = [];
                feedbackData = {};
                
                // Reset UI
                document.querySelectorAll('.task-checkbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');
                
                // Reset results
                updateResults();
                
                alert('Test session reset');
            }
        }

        // A/B Testing variant rating
        function rateVariant(variant) {
            const rating = prompt(`Rate variant ${variant} (1-5 stars):`);
            if (rating && !isNaN(rating) && rating >= 1 && rating <= 5) {
                variantRatings[variant] = parseInt(rating);
                updateResults();
                alert(`Variant ${variant} rated ${rating} stars`);
            }
        }

        // Vision filter application
        function applyVisionFilter(filter) {
            const content = document.getElementById('vision-test-content');
            const presets = document.querySelectorAll('.vision-preset');
            
            // Remove active class from all presets
            presets.forEach(preset => preset.classList.remove('active'));
            
            // Add active class to clicked preset
            event.target.closest('.vision-preset').classList.add('active');
            
            // Apply filter
            content.style.filter = '';
            switch(filter) {
                case 'colorblind':
                    content.style.filter = 'grayscale(100%)';
                    break;
                case 'low-contrast':
                    content.style.filter = 'contrast(0.5)';
                    break;
                case 'blur':
                    content.style.filter = 'blur(1px)';
                    break;
                default:
                    content.style.filter = '';
            }
        }

        // Sunglasses simulation
        function toggleSunglasses() {
            const content = document.getElementById('sunglasses-content');
            const button = document.querySelector('.sunglasses-toggle');
            
            if (content.classList.contains('sunglasses-active')) {
                content.classList.remove('sunglasses-active');
                button.textContent = 'Toggle Sunglasses Simulation';
            } else {
                content.classList.add('sunglasses-active');
                button.textContent = 'Remove Sunglasses Simulation';
            }
        }

        // Task timing
        function startTaskTimer() {
            taskStartTime = new Date();
            currentTask = 0;
            alert('Task timer started. Begin reading the first task.');
        }

        function completeTask() {
            if (!taskStartTime) {
                alert('Please start the task timer first');
                return;
            }
            
            const checkboxes = document.querySelectorAll('.task-checkbox');
            const completedTasks = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            if (completedTasks > currentTask) {
                const endTime = new Date();
                const taskTime = (endTime - taskStartTime) / 1000; // seconds
                taskTimes.push(taskTime);
                
                // Update time display
                const timeElement = document.getElementById(`time${completedTasks}`);
                const minutes = Math.floor(taskTime / 60);
                const seconds = Math.floor(taskTime % 60);
                timeElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                currentTask = completedTasks;
                taskStartTime = new Date(); // Reset for next task
                
                updateResults();
            }
        }

        // Feedback submission
        function submitFeedback() {
            const readabilityRating = document.querySelector('input[name="readability"]:checked');
            const textareas = document.querySelectorAll('textarea');
            
            if (!readabilityRating) {
                alert('Please provide a readability rating');
                return;
            }
            
            feedbackData = {
                readability: parseInt(readabilityRating.value),
                difficulties: textareas[0].value,
                sunglassesImpact: textareas[1].value,
                improvements: textareas[2].value,
                timestamp: new Date().toISOString()
            };
            
            updateResults();
            alert('Feedback submitted successfully!');
        }

        // Update results dashboard
        function updateResults() {
            // Calculate completion rate
            const totalTasks = 3;
            const completedTasks = document.querySelectorAll('.task-checkbox:checked').length;
            const completionRate = Math.round((completedTasks / totalTasks) * 100);
            document.getElementById('completion-rate').textContent = completionRate + '%';
            
            // Calculate average time
            if (taskTimes.length > 0) {
                const avgTime = taskTimes.reduce((a, b) => a + b, 0) / taskTimes.length;
                const minutes = Math.floor(avgTime / 60);
                const seconds = Math.floor(avgTime % 60);
                document.getElementById('avg-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Calculate readability score
            if (feedbackData.readability) {
                document.getElementById('readability-score').textContent = feedbackData.readability.toFixed(1);
            }
            
            // Determine preferred variant
            if (variantRatings.A > 0 || variantRatings.B > 0) {
                const preferred = variantRatings.A > variantRatings.B ? 'A' : 
                                variantRatings.B > variantRatings.A ? 'B' : 'Tie';
                document.getElementById('variant-preference').textContent = preferred;
            }
        }

        // Export results
        function exportResults() {
            const results = {
                participantId: document.getElementById('participant-id').value,
                deviceType: document.getElementById('device-type').value,
                visionAbility: document.getElementById('vision-ability').value,
                lightingCondition: document.getElementById('lighting-condition').value,
                testStartTime: testStartTime,
                variantRatings: variantRatings,
                taskTimes: taskTimes,
                feedbackData: feedbackData,
                completionRate: document.getElementById('completion-rate').textContent,
                averageTime: document.getElementById('avg-time').textContent,
                readabilityScore: document.getElementById('readability-score').textContent,
                preferredVariant: document.getElementById('variant-preference').textContent
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `readability-test-${results.participantId}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Results exported successfully!');
        }

        // Generate report
        function generateReport() {
            const report = `
Mobile Readability Test Report
============================

Participant: ${document.getElementById('participant-id').value}
Device: ${document.getElementById('device-type').value}
Vision: ${document.getElementById('vision-ability').value}
Lighting: ${document.getElementById('lighting-condition').value}

Test Results:
- Completion Rate: ${document.getElementById('completion-rate').textContent}
- Average Task Time: ${document.getElementById('avg-time').textContent}
- Readability Score: ${document.getElementById('readability-score').textContent}
- Preferred Variant: ${document.getElementById('variant-preference').textContent}

Variant Ratings:
- Variant A: ${variantRatings.A}/5
- Variant B: ${variantRatings.B}/5

User Feedback:
${feedbackData.difficulties ? `Difficulties: ${feedbackData.difficulties}` : ''}
${feedbackData.sunglassesImpact ? `Sunglasses Impact: ${feedbackData.sunglassesImpact}` : ''}
${feedbackData.improvements ? `Suggested Improvements: ${feedbackData.improvements}` : ''}

Generated: ${new Date().toLocaleString()}
            `;
            
            const dataBlob = new Blob([report], {type: 'text/plain'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `readability-report-${document.getElementById('participant-id').value}-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            alert('Report generated successfully!');
        }

        // Event listeners for task checkboxes
        document.querySelectorAll('.task-checkbox').forEach((checkbox, index) => {
            checkbox.addEventListener('change', function() {
                if (this.checked && taskStartTime) {
                    const endTime = new Date();
                    const taskTime = (endTime - taskStartTime) / 1000;
                    taskTimes[index] = taskTime;
                    
                    const minutes = Math.floor(taskTime / 60);
                    const seconds = Math.floor(taskTime % 60);
                    document.getElementById(`time${index + 1}`).textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    updateResults();
                }
            });
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateResults();
        });
    </script>
</body>
</html>
