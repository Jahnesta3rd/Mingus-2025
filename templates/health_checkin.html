<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Health Check-in - Mingus</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .form-content {
            padding: 40px;
        }
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }
        .section-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 1rem;
        }
        .form-label .required-indicator {
            color: #dc2626;
            margin-left: 0.25rem;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-input.error, .form-select.error {
            border-color: #dc2626;
        }
        .form-input.error:focus, .form-select.error:focus {
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        .form-range {
            width: 100%;
            margin: 10px 0;
            height: 6px;
            border-radius: 3px;
            background: #d1d5db;
            outline: none;
            -webkit-appearance: none;
        }
        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        .form-range::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .progress-bar {
            background: #e1e5e9;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        .error-message {
            display: none;
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.375rem;
        }
        .error-message.show {
            display: block;
        }
        .form-help-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
            margin-bottom: 0.5rem;
        }
        .validation-feedback {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #2563eb;
        }
        .fieldset {
            border: none;
            padding: 0;
            margin: 0;
        }
        .legend {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .success-message {
            display: none;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            color: #065f46;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        .last-checkin-info {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1e40af;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        /* Focus indicators for keyboard navigation */
        .form-input:focus-visible,
        .form-select:focus-visible,
        .form-range:focus-visible,
        .submit-btn:focus-visible {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .form-input, .form-select, .form-range {
                border-width: 3px;
            }
            .submit-btn {
                border: 3px solid #ffffff;
            }
        }
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .submit-btn:hover:not(:disabled) {
                transform: none;
            }
            .progress-fill {
                transition: none;
            }
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .form-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Weekly Health Check-in</h1>
            <p>Track your wellness and see how it connects to your financial health</p>
        </div>
        
        <div class="form-content">
            <!-- Progress indicator -->
            <div class="progress-bar" role="progressbar" aria-label="Form completion progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <!-- Success message -->
            <div class="success-message" id="successMessage" role="alert" aria-live="polite">
                <strong>‚úÖ Health check-in submitted successfully!</strong><br>
                Your wellness data has been recorded and will be analyzed for financial correlations.
            </div>
            
            <!-- Last check-in information -->
            <div class="last-checkin-info" id="lastCheckinInfo" role="status" aria-live="polite">
                <strong>üìÖ Last Check-in:</strong> <span id="lastCheckinDate">No previous check-ins found</span>
            </div>
            
            <form id="healthForm" onsubmit="submitForm(event)" novalidate aria-label="Weekly Health Check-in Form">
                <!-- Physical Activity Section -->
                <fieldset class="fieldset">
                    <legend class="legend">
                        <div class="section-icon" aria-hidden="true">üèÉ</div>
                        Physical Activity
                    </legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="physical_activity_minutes">
                                Activity Minutes Today
                            </label>
                            <div class="form-help-text">Enter the total minutes of physical activity you did today</div>
                            <input 
                                type="number" 
                                id="physical_activity_minutes" 
                                name="physical_activity_minutes"
                                class="form-input"
                                min="0" 
                                max="480"
                                placeholder="e.g., 30"
                                aria-describedby="physicalActivityHelp physicalActivityError"
                                aria-invalid="false"
                                onchange="updateProgress()"
                            >
                            <div class="validation-feedback" id="physicalActivityHelp">Include exercise, walking, sports, or any physical movement</div>
                            <div class="error-message" id="physicalActivityError" role="alert" aria-live="polite"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="physical_activity_level">
                                Activity Level
                            </label>
                            <div class="form-help-text">Select the intensity level of your physical activity</div>
                            <select 
                                id="physical_activity_level" 
                                name="physical_activity_level" 
                                class="form-select" 
                                onchange="updateProgress()"
                                aria-describedby="physicalActivityLevelHelp"
                             class="form-input">
                                <option value="">Select activity level</option>
                                <option value="low">Low - Light walking, stretching</option>
                                <option value="moderate">Moderate - Brisk walking, light jogging</option>
                                <option value="high">High - Running, intense workouts</option>
                            </select>
                            <div class="validation-feedback" id="physicalActivityLevelHelp">Choose the level that best describes your activity intensity</div>
                        </div>
                    </div>
                </fieldset>

                <!-- Relationships Section -->
                <fieldset class="fieldset">
                    <legend class="legend">
                        <div class="section-icon" aria-hidden="true">‚ù§Ô∏è</div>
                        Relationships & Social
                    </legend>
                    
                    <div class="form-group">
                        <label class="form-label" for="relationships_rating">
                            How would you rate your relationships this week? (1-10)
                            <span class="required-indicator" aria-label="required">*</span>
                        </label>
                        <div class="form-help-text">Rate your overall relationship satisfaction and social connections this week</div>
                        <input 
                            type="range" 
                            id="relationships_rating" 
                            name="relationships_rating"
                            class="form-range"
                            min="1" 
                            max="10" 
                            value="5"
                            required
                            aria-describedby="relationshipsRatingHelp relationshipsRatingValue"
                            aria-valuemin="1"
                            aria-valuemax="10"
                            aria-valuenow="5"
                            aria-valuetext="5 - Neutral"
                            onchange="updateProgress(); updateRangeValue('relationships_rating', 'relationshipsRatingValue')"
                        >
                        <div class="range-labels">
                            <span>1: Very Strained</span>
                            <span>10: Excellent</span>
                        </div>
                        <div class="validation-feedback" id="relationshipsRatingValue" aria-live="polite">5 - Neutral</div>
                        <div class="validation-feedback" id="relationshipsRatingHelp">Consider your interactions with family, friends, colleagues, and romantic partners</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="relationships_notes">
                            Notes about your relationships
                        </label>
                        <div class="form-help-text">Optional: Share specific thoughts about your relationships this week</div>
                        <textarea 
                            id="relationships_notes" 
                            name="relationships_notes"
                            class="form-input"
                            rows="3"
                            placeholder="How are your relationships affecting your well-being?"
                            onchange="updateProgress()"
                            aria-describedby="relationshipsNotesHelp"
                         class="form-input"></textarea>
                        <div class="validation-feedback" id="relationshipsNotesHelp">This helps us understand the connection between your social life and financial decisions</div>
                    </div>
                </fieldset>

                <!-- Mindfulness Section -->
                <fieldset class="fieldset">
                    <legend class="legend">
                        <div class="section-icon" aria-hidden="true">üßò‚Äç‚ôÄÔ∏è</div>
                        Mindfulness & Mental Health
                    </legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="mindfulness_minutes">
                                Mindfulness Minutes Today
                            </label>
                            <div class="form-help-text">Enter the total minutes spent on mindfulness activities today</div>
                            <input 
                                type="number" 
                                id="mindfulness_minutes" 
                                name="mindfulness_minutes"
                                class="form-input"
                                min="0" 
                                max="120"
                                placeholder="e.g., 15"
                                onchange="updateProgress()"
                                aria-describedby="mindfulnessMinutesHelp"
                                aria-invalid="false"
                            >
                            <div class="validation-feedback" id="mindfulnessMinutesHelp">Include meditation, prayer, deep breathing, or other mindfulness practices</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="mindfulness_type">
                                Mindfulness Type
                            </label>
                            <div class="form-help-text">Select the primary type of mindfulness practice you engaged in</div>
                            <select 
                                id="mindfulness_type" 
                                name="mindfulness_type" 
                                class="form-select" 
                                onchange="updateProgress()"
                                aria-describedby="mindfulnessTypeHelp"
                             class="form-input">
                                <option value="">Select type</option>
                                <option value="meditation">Meditation</option>
                                <option value="yoga">Yoga</option>
                                <option value="breathing">Breathing Exercises</option>
                                <option value="walking">Walking Meditation</option>
                                <option value="journaling">Journaling</option>
                                <option value="prayer">Prayer</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="validation-feedback" id="mindfulnessTypeHelp">Choose the practice that best describes your mindfulness activity</div>
                        </div>
                    </div>
                </fieldset>

                <!-- Wellness Metrics Section -->
                <fieldset class="fieldset">
                    <legend class="legend">
                        <div class="section-icon" aria-hidden="true">üìä</div>
                        Wellness Metrics
                    </legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="stress_level">
                                Stress Level (1-10)
                                <span class="required-indicator" aria-label="required">*</span>
                            </label>
                            <div class="form-help-text">Rate your overall stress level this week</div>
                            <input 
                                type="range" 
                                id="stress_level" 
                                name="stress_level"
                                class="form-range"
                                min="1" 
                                max="10" 
                                value="5"
                                required
                                aria-describedby="stressLevelHelp stressLevelValue"
                                aria-valuemin="1"
                                aria-valuemax="10"
                                aria-valuenow="5"
                                aria-valuetext="5 - Moderate"
                                onchange="updateProgress(); updateRangeValue('stress_level', 'stressLevelValue')"
                            >
                            <div class="range-labels">
                                <span>1: Very Low</span>
                                <span>10: Very High</span>
                            </div>
                            <div class="validation-feedback" id="stressLevelValue" aria-live="polite">5 - Moderate</div>
                            <div class="validation-feedback" id="stressLevelHelp">Consider work stress, financial worries, personal challenges, and daily pressures</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="energy_level">
                                Energy Level (1-10)
                                <span class="required-indicator" aria-label="required">*</span>
                            </label>
                            <div class="form-help-text">Rate your overall energy and vitality this week</div>
                            <input 
                                type="range" 
                                id="energy_level" 
                                name="energy_level"
                                class="form-range"
                                min="1" 
                                max="10" 
                                value="5"
                                required
                                aria-describedby="energyLevelHelp energyLevelValue"
                                aria-valuemin="1"
                                aria-valuemax="10"
                                aria-valuenow="5"
                                aria-valuetext="5 - Moderate"
                                onchange="updateProgress(); updateRangeValue('energy_level', 'energyLevelValue')"
                            >
                            <div class="range-labels">
                                <span>1: Very Low</span>
                                <span>10: Very High</span>
                            </div>
                            <div class="validation-feedback" id="energyLevelValue" aria-live="polite">5 - Moderate</div>
                            <div class="validation-feedback" id="energyLevelHelp">Consider your physical energy, mental alertness, and motivation levels</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="mood_rating">
                            Mood Rating (1-10)
                            <span class="required-indicator" aria-label="required">*</span>
                        </label>
                        <div class="form-help-text">Rate your overall mood and emotional well-being this week</div>
                        <input 
                            type="range" 
                            id="mood_rating" 
                            name="mood_rating"
                            class="form-range"
                            min="1" 
                            max="10" 
                            value="5"
                            required
                            aria-describedby="moodRatingHelp moodRatingValue"
                            aria-valuemin="1"
                            aria-valuemax="10"
                            aria-valuenow="5"
                            aria-valuetext="5 - Neutral"
                            onchange="updateProgress(); updateRangeValue('mood_rating', 'moodRatingValue')"
                        >
                        <div class="range-labels">
                            <span>1: Very Poor</span>
                            <span>10: Excellent</span>
                        </div>
                        <div class="validation-feedback" id="moodRatingValue" aria-live="polite">5 - Neutral</div>
                        <div class="validation-feedback" id="moodRatingHelp">Consider your overall emotional state, happiness, and satisfaction with life</div>
                    </div>
                </fieldset>

                <button type="submit" class="submit-btn btn-cta btn-primary" id="submitBtn" aria-describedby="submitHelp">
                    Submit Health Check-in
                </button>
                <div class="validation-feedback" id="submitHelp">Click submit to save your weekly health check-in data</div>
            </form>
        </div>
    </div>

    <script>
        // Screen reader announcements
        function announceToScreenReader(message) {
            let liveRegion = document.getElementById('screen-reader-announcements');
            if (!liveRegion) {
                liveRegion = document.createElement('div');
                liveRegion.id = 'screen-reader-announcements';
                liveRegion.setAttribute('aria-live', 'polite');
                liveRegion.setAttribute('aria-atomic', 'true');
                liveRegion.className = 'sr-only';
                document.body.appendChild(liveRegion);
            }
            
            liveRegion.textContent = message;
            
            setTimeout(() => {
                liveRegion.textContent = '';
            }, 1000);
        }

        // Update range slider values
        function updateRangeValue(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);
            const value = parseInt(slider.value);
            
            let text = '';
            if (sliderId === 'relationships_rating') {
                const labels = ['1 - Very Strained', '2 - Strained', '3 - Poor', '4 - Below Average', '5 - Neutral', '6 - Above Average', '7 - Good', '8 - Very Good', '9 - Excellent', '10 - Outstanding'];
                text = labels[value - 1];
            } else if (sliderId === 'stress_level') {
                const labels = ['1 - Very Low', '2 - Low', '3 - Below Average', '4 - Slightly Low', '5 - Moderate', '6 - Slightly High', '7 - Above Average', '8 - High', '9 - Very High', '10 - Extreme'];
                text = labels[value - 1];
            } else if (sliderId === 'energy_level') {
                const labels = ['1 - Very Low', '2 - Low', '3 - Below Average', '4 - Slightly Low', '5 - Moderate', '6 - Slightly High', '7 - Above Average', '8 - High', '9 - Very High', '10 - Extreme'];
                text = labels[value - 1];
            } else if (sliderId === 'mood_rating') {
                const labels = ['1 - Very Poor', '2 - Poor', '3 - Below Average', '4 - Slightly Poor', '5 - Neutral', '6 - Slightly Good', '7 - Above Average', '8 - Good', '9 - Very Good', '10 - Excellent'];
                text = labels[value - 1];
            }
            
            valueDisplay.textContent = text;
            slider.setAttribute('aria-valuetext', text);
            slider.setAttribute('aria-valuenow', value);
            
            announceToScreenReader(`${sliderId.replace('_', ' ')} set to ${text}`);
        }

        function updateProgress() {
            const form = document.getElementById('healthForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            const filledInputs = Array.from(inputs).filter(input => {
                if (input.type === 'range') {
                    return input.value !== '5'; // Default value
                }
                return input.value.trim() !== '';
            });
            
            const progress = (filledInputs.length / inputs.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update ARIA progress bar
            const progressBar = document.querySelector('[role="progressbar"]');
            progressBar.setAttribute('aria-valuenow', Math.round(progress));
            progressBar.setAttribute('aria-valuetext', `${Math.round(progress)}% complete`);
        }

        function validateForm() {
            const form = document.getElementById('healthForm');
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                const errorElement = document.getElementById(field.id + 'Error');
                field.classList.remove('error');
                field.setAttribute('aria-invalid', 'false');
                
                if (errorElement) {
                    errorElement.style.display = 'none';
                    errorElement.classList.remove('show');
                }
                
                if (!field.value || field.value.trim() === '') {
                    isValid = false;
                    field.classList.add('error');
                    field.setAttribute('aria-invalid', 'true');
                    
                    if (errorElement) {
                        errorElement.textContent = 'This field is required';
                        errorElement.style.display = 'block';
                        errorElement.classList.add('show');
                    }
                }
            });
            
            return isValid;
        }

        function submitForm(event) {
            event.preventDefault();
            
            if (!validateForm()) {
                announceToScreenReader('Form has validation errors. Please fill in all required fields.');
                // Focus first error field
                const firstError = document.querySelector('.error');
                if (firstError) {
                    firstError.focus();
                }
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            // Convert string values to numbers where appropriate
            data.physical_activity_minutes = parseInt(data.physical_activity_minutes) || null;
            data.relationships_rating = parseInt(data.relationships_rating);
            data.mindfulness_minutes = parseInt(data.mindfulness_minutes) || null;
            data.stress_level = parseInt(data.stress_level);
            data.energy_level = parseInt(data.energy_level);
            data.mood_rating = parseInt(data.mood_rating);
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.setAttribute('aria-busy', 'true');
            submitBtn.textContent = 'Submitting...';
            
            announceToScreenReader('Submitting health check-in, please wait...');
            
            fetch('/api/health/checkin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess();
                    announceToScreenReader('Health check-in submitted successfully!');
                } else {
                    throw new Error(data.error || 'Failed to submit check-in');
                }
            })
            .catch((error) => {
                announceToScreenReader(`Error submitting check-in: ${error.message}`);
                alert('Error submitting check-in: ' + error.message);
                
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.removeAttribute('aria-busy');
                submitBtn.textContent = 'Submit Health Check-in';
            });
        }

        function showSuccess() {
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('healthForm').style.display = 'none';
            
            // Reset button state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.removeAttribute('aria-busy');
            submitBtn.textContent = 'Submit Health Check-in';
        }

        // Load last check-in information
        function loadLastCheckin() {
            fetch('/api/health/checkin/latest')
                .then(response => response.json())
                .then(data => {
                    if (data.checkin) {
                        const date = new Date(data.checkin.checkin_date);
                        document.getElementById('lastCheckinDate').textContent = date.toLocaleDateString();
                        announceToScreenReader(`Last check-in was on ${date.toLocaleDateString()}`);
                    }
                })
                .catch(error => {
                    console.log('No previous check-ins found');
                });
        }

        // Initialize form
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
            loadLastCheckin();
            announceToScreenReader('Weekly Health Check-in form loaded. Please fill out all required fields marked with an asterisk.');
        });
    </script>
</body>
</html>
