<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Health Assessment - Mingus</title>
  <link rel="stylesheet" href="/static/css/form.css">
  <style>
    .questionnaire-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    
    .header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 0.5rem;
    }
    
    .header p {
      color: #6b7280;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    .progress-container {
      margin-bottom: 2rem;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2563eb, #3b82f6);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .progress-text {
      text-align: center;
      margin-top: 0.5rem;
      color: #6b7280;
      font-size: 0.9rem;
    }
    
    .questionnaire-form {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .question-section {
      margin-bottom: 2.5rem;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
    }
    
    .question-section:nth-child(1) { animation-delay: 0.1s; }
    .question-section:nth-child(2) { animation-delay: 0.2s; }
    .question-section:nth-child(3) { animation-delay: 0.3s; }
    .question-section:nth-child(4) { animation-delay: 0.4s; }
    .question-section:nth-child(5) { animation-delay: 0.5s; }
    .question-section:nth-child(6) { animation-delay: 0.6s; }
    
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .section-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #374151;
      font-size: 1rem;
    }
    
    .form-label .required-indicator {
      color: #dc2626;
      margin-left: 0.25rem;
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .form-input.error, .form-select.error {
      border-color: #dc2626;
    }
    
    .form-input.error:focus, .form-select.error:focus {
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .error-message {
      display: none;
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      padding: 0.5rem;
      background-color: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 0.375rem;
    }
    
    .error-message.show {
      display: block;
    }
    
    .range-container {
      margin-top: 1rem;
    }
    
    .range-slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #d1d5db;
      outline: none;
      -webkit-appearance: none;
    }
    
    .range-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #2563eb;
      cursor: pointer;
    }
    
    .range-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #2563eb;
      cursor: pointer;
      border: none;
    }
    
    .range-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    .range-value {
      text-align: center;
      margin-top: 0.5rem;
      font-weight: 600;
      color: #2563eb;
      font-size: 1.1rem;
    }
    
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 1.25rem;
      height: 1.25rem;
      accent-color: #2563eb;
    }
    
    .checkbox-item label {
      font-size: 0.95rem;
      color: #374151;
      cursor: pointer;
    }
    
    .submit-container {
      text-align: center;
      margin-top: 2rem;
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-width: 200px;
    }
    
    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
    }
    
    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .loading {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .success-message {
      display: none;
      background: #ecfdf5;
      border: 1px solid #a7f3d0;
      color: #065f46;
      padding: 1.5rem;
      border-radius: 0.5rem;
      text-align: center;
      margin-bottom: 2rem;
    }
    
    /* Accessibility improvements */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    .fieldset {
      border: none;
      padding: 0;
      margin: 0;
    }
    
    .legend {
      font-size: 1.3rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .form-help-text {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 0.25rem;
      margin-bottom: 0.5rem;
    }
    
    .validation-feedback {
      margin-top: 0.5rem;
      font-size: 0.875rem;
    }
    
    .validation-feedback.success {
      color: #059669;
    }
    
    .validation-feedback.error {
      color: #dc2626;
    }
    
    .validation-feedback.info {
      color: #2563eb;
    }
    
    /* Focus indicators for keyboard navigation */
    .form-input:focus-visible,
    .form-select:focus-visible,
    .submit-btn:focus-visible {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
      .form-input, .form-select {
        border-width: 3px;
      }
      
      .submit-btn {
        border: 3px solid #ffffff;
      }
    }
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .question-section {
        animation: none;
        opacity: 1;
        transform: none;
      }
      
      .submit-btn:hover:not(:disabled) {
        transform: none;
      }
    }
  </style>
</head>
<body>
  <div class="questionnaire-container">
    <!-- Header -->
    <div class="header">
      <h1>Financial Health Assessment</h1>
      <p>Quick assessment to understand your financial situation and provide personalized recommendations</p>
    </div>

    <!-- Progress indicator -->
    <div class="progress-container" role="progressbar" aria-label="Form completion progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0% Complete</div>
    </div>

    <!-- Success message -->
    <div class="success-message" id="successMessage" role="alert" aria-live="polite">
      <strong>‚úÖ Assessment submitted successfully!</strong><br>
      Your financial health score and personalized recommendations are being generated.
    </div>

    <!-- Financial Questionnaire Form -->
    <form class="questionnaire-form" id="financialQuestionnaireForm" novalidate aria-label="Financial Health Assessment Form">
      <!-- Income Section -->
      <fieldset class="fieldset">
        <legend class="legend">
          <div class="section-icon" aria-hidden="true">üí∞</div>
          Income
        </legend>
        
        <div class="form-group">
          <label class="form-label" for="monthly_income">
            What's your approximate monthly income? (before taxes)
            <span class="required-indicator" aria-label="required">*</span>
          </label>
          <div class="form-help-text">Enter your total monthly income from all sources before taxes and deductions</div>
          <input 
            type="number" 
            id="monthly_income" 
            name="monthly_income"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 5000"
            required
            aria-describedby="monthlyIncomeError monthlyIncomeHelp"
            aria-invalid="false"
          >
          <div class="error-message" id="monthlyIncomeError" role="alert" aria-live="polite"></div>
          <div class="validation-feedback info" id="monthlyIncomeHelp">This information helps us provide accurate financial recommendations</div>
        </div>
      </fieldset>

      <!-- Expenses Section -->
      <fieldset class="fieldset">
        <legend class="legend">
          <div class="section-icon" aria-hidden="true">üìä</div>
          Monthly Expenses
        </legend>
        
        <div class="form-group">
          <label class="form-label" for="monthly_expenses">
            What are your total monthly expenses? (rent, bills, food, etc.)
            <span class="required-indicator" aria-label="required">*</span>
          </label>
          <div class="form-help-text">Include all regular monthly expenses like housing, utilities, food, transportation, and entertainment</div>
          <input 
            type="number" 
            id="monthly_expenses" 
            name="monthly_expenses"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 3000"
            required
            aria-describedby="monthlyExpensesError monthlyExpensesHelp"
            aria-invalid="false"
          >
          <div class="error-message" id="monthlyExpensesError" role="alert" aria-live="polite"></div>
          <div class="validation-feedback info" id="monthlyExpensesHelp">Understanding your expenses helps us identify savings opportunities</div>
        </div>
      </fieldset>

      <!-- Savings Section -->
      <fieldset class="fieldset">
        <legend class="legend">
          <div class="section-icon" aria-hidden="true">üè¶</div>
          Savings & Emergency Fund
        </legend>
        
        <div class="form-group">
          <label class="form-label" for="current_savings">
            How much do you currently have in savings?
            <span class="required-indicator" aria-label="required">*</span>
          </label>
          <div class="form-help-text">Include all savings accounts, emergency funds, and liquid assets</div>
          <input 
            type="number" 
            id="current_savings" 
            name="current_savings"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 10000"
            required
            aria-describedby="currentSavingsError currentSavingsHelp"
            aria-invalid="false"
          >
          <div class="error-message" id="currentSavingsError" role="alert" aria-live="polite"></div>
          <div class="validation-feedback info" id="currentSavingsHelp">Your current savings help us assess your financial security</div>
        </div>
      </fieldset>

      <!-- Debt Section -->
      <fieldset class="fieldset">
        <legend class="legend">
          <div class="section-icon" aria-hidden="true">üí≥</div>
          Debt
        </legend>
        
        <div class="form-group">
          <label class="form-label" for="total_debt">
            What's your total debt? (credit cards, loans, etc.)
            <span class="required-indicator" aria-label="required">*</span>
          </label>
          <div class="form-help-text">Include all outstanding balances on credit cards, loans, and other debts</div>
          <input 
            type="number" 
            id="total_debt" 
            name="total_debt"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 15000"
            required
            aria-describedby="totalDebtError totalDebtHelp"
            aria-invalid="false"
          >
          <div class="error-message" id="totalDebtError" role="alert" aria-live="polite"></div>
          <div class="validation-feedback info" id="totalDebtHelp">Understanding your debt helps us create a repayment strategy</div>
        </div>
      </fieldset>

      <!-- Risk Tolerance Section -->
      <fieldset class="fieldset">
        <legend class="legend">
          <div class="section-icon" aria-hidden="true">üéØ</div>
          Investment Risk Tolerance
        </legend>
        
        <div class="form-group">
          <label class="form-label" for="risk_tolerance">
            How comfortable are you with investment risk?
            <span class="required-indicator" aria-label="required">*</span>
          </label>
          <div class="form-help-text">Move the slider to indicate your comfort level with investment risk</div>
          <div class="range-container">
            <input 
              type="range" 
              id="risk_tolerance" 
              name="risk_tolerance"
              class="range-slider"
              min="1" 
              max="5" 
              value="3"
              required
              aria-describedby="riskToleranceValue riskToleranceHelp"
              aria-valuemin="1"
              aria-valuemax="5"
              aria-valuenow="3"
              aria-valuetext="Moderate"
            >
            <div class="range-labels">
              <span>Conservative</span>
              <span>Aggressive</span>
            </div>
            <div class="range-value" id="riskToleranceValue" aria-live="polite">Moderate</div>
            <div class="validation-feedback info" id="riskToleranceHelp">Your risk tolerance helps us recommend appropriate investment strategies</div>
          </div>
        </div>
      </fieldset>

      <!-- Financial Goals Section -->
      <fieldset class="fieldset">
        <legend class="legend">
          <div class="section-icon" aria-hidden="true">üéØ</div>
          Financial Goals
        </legend>
        
        <div class="form-group">
          <label class="form-label">
            What are your main financial goals? (Select all that apply)
            <span class="required-indicator" aria-label="required">*</span>
          </label>
          <div class="form-help-text">Choose all the financial goals that are important to you</div>
          <div class="checkbox-group" role="group" aria-labelledby="financial-goals-group">
            <div class="checkbox-item">
              <input type="checkbox" id="goal_emergency" name="financial_goals" value="emergency_fund" aria-describedby="goal_emergency_desc">
              <label for="goal_emergency">Build emergency fund</label>
              <div class="sr-only" id="goal_emergency_desc">Build a safety net for unexpected expenses</div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_debt" name="financial_goals" value="debt_payoff" aria-describedby="goal_debt_desc">
              <label for="goal_debt">Pay off debt</label>
              <div class="sr-only" id="goal_debt_desc">Eliminate high-interest debt to improve financial health</div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_savings" name="financial_goals" value="savings" aria-describedby="goal_savings_desc">
              <label for="goal_savings">Save for major purchase</label>
              <div class="sr-only" id="goal_savings_desc">Save for a car, home, or other major expense</div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_investment" name="financial_goals" value="investment" aria-describedby="goal_investment_desc">
              <label for="goal_investment">Start investing</label>
              <div class="sr-only" id="goal_investment_desc">Begin building wealth through investments</div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_retirement" name="financial_goals" value="retirement" aria-describedby="goal_retirement_desc">
              <label for="goal_retirement">Plan for retirement</label>
              <div class="sr-only" id="goal_retirement_desc">Secure your financial future for retirement</div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_home" name="financial_goals" value="home_purchase" aria-describedby="goal_home_desc">
              <label for="goal_home">Buy a home</label>
              <div class="sr-only" id="goal_home_desc">Save for a down payment on a home</div>
            </div>
          </div>
          <div class="error-message" id="financialGoalsError" role="alert" aria-live="polite"></div>
          <div class="validation-feedback info">Selecting your goals helps us create a personalized financial plan</div>
        </div>
      </fieldset>

      <!-- Submit Button -->
      <div class="submit-container">
        <button type="submit" class="submit-btn btn-cta btn-primary" id="submitBtn" aria-describedby="submitHelp">
          <span class="loading" id="loadingSpinner" style="display: none;" aria-hidden="true"></span>
          Get My Financial Health Score
        </button>
        <div class="validation-feedback info" id="submitHelp">Click submit to receive your personalized financial health assessment</div>
      </div>
    </form>
  </div>

  <script>
    class FinancialQuestionnaire {
      constructor() {
        this.form = document.getElementById('financialQuestionnaireForm');
        this.submitBtn = document.getElementById('submitBtn');
        this.loadingSpinner = document.getElementById('loadingSpinner');
        this.successMessage = document.getElementById('successMessage');
        this.progressFill = document.getElementById('progressFill');
        this.progressText = document.getElementById('progressText');
        
        this.initializeEventListeners();
        this.updateProgress();
        this.announceToScreenReader('Financial Health Assessment form loaded. Please fill out all required fields marked with an asterisk.');
      }

      initializeEventListeners() {
        // Form submission
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));

        // Range slider updates
        const rangeSlider = document.getElementById('risk_tolerance');
        rangeSlider.addEventListener('input', (e) => this.updateRangeValue(e));

        // Form field changes for progress tracking
        const formFields = this.form.querySelectorAll('input, select');
        formFields.forEach(field => {
          field.addEventListener('change', () => this.updateProgress());
          field.addEventListener('input', () => this.updateProgress());
        });

        // Real-time validation
        formFields.forEach(field => {
          field.addEventListener('blur', (e) => this.validateField(e.target));
          field.addEventListener('input', (e) => this.clearFieldError(e.target));
        });

        // Keyboard navigation support
        this.form.addEventListener('keydown', (e) => this.handleKeyboardNavigation(e));
      }

      updateRangeValue(event) {
        const slider = event.target;
        const valueDisplay = document.getElementById('riskToleranceValue');
        const value = parseInt(slider.value);
        
        const labels = ['Very Conservative', 'Conservative', 'Moderate', 'Aggressive', 'Very Aggressive'];
        const newLabel = labels[value - 1];
        
        valueDisplay.textContent = newLabel;
        slider.setAttribute('aria-valuetext', newLabel);
        slider.setAttribute('aria-valuenow', value);
        
        this.updateProgress();
        this.announceToScreenReader(`Risk tolerance set to ${newLabel}`);
      }

      updateProgress() {
        const formFields = this.form.querySelectorAll('input[required], select[required]');
        const totalFields = formFields.length;
        let completedFields = 0;

        formFields.forEach(field => {
          if (field.type === 'checkbox') {
            // For checkboxes, check if at least one is selected
            const checkboxGroup = field.name;
            const checkboxes = this.form.querySelectorAll(`input[name="${checkboxGroup}"]:checked`);
            if (checkboxes.length > 0) {
              completedFields++;
            }
          } else if (field.value.trim() !== '') {
            completedFields++;
          }
        });

        const progress = totalFields > 0 ? (completedFields / totalFields) * 100 : 0;
        this.progressFill.style.width = `${progress}%`;
        this.progressText.textContent = `${Math.round(progress)}% Complete`;
        
        // Update ARIA progress bar
        const progressBar = document.querySelector('[role="progressbar"]');
        progressBar.setAttribute('aria-valuenow', Math.round(progress));
        progressBar.setAttribute('aria-valuetext', `${Math.round(progress)}% complete`);
      }

      validateField(field) {
        const errorElement = document.getElementById(field.id + 'Error');
        let isValid = true;
        let errorMessage = '';

        // Remove existing error styling
        field.classList.remove('error');
        field.setAttribute('aria-invalid', 'false');
        if (errorElement) {
          errorElement.style.display = 'none';
          errorElement.classList.remove('show');
        }

        // Validation rules
        if (field.hasAttribute('required') && field.value.trim() === '') {
          isValid = false;
          errorMessage = 'This field is required';
        } else if (field.type === 'number') {
          const value = parseFloat(field.value);
          if (field.value && value < 0) {
            isValid = false;
            errorMessage = 'Please enter a positive number';
          }
        } else if (field.type === 'checkbox' && field.name === 'financial_goals') {
          // Check if at least one goal is selected
          const checkboxes = this.form.querySelectorAll('input[name="financial_goals"]:checked');
          if (checkboxes.length === 0) {
            isValid = false;
            errorMessage = 'Please select at least one financial goal';
          }
        }

        // Apply error styling and message
        if (!isValid) {
          field.classList.add('error');
          field.setAttribute('aria-invalid', 'true');
          if (errorElement) {
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
            errorElement.classList.add('show');
          }
          
          // Announce error to screen reader
          this.announceToScreenReader(`Error: ${errorMessage}`);
        }

        return isValid;
      }

      clearFieldError(field) {
        if (field.classList.contains('error')) {
          field.classList.remove('error');
          field.setAttribute('aria-invalid', 'false');
          const errorElement = document.getElementById(field.id + 'Error');
          if (errorElement) {
            errorElement.style.display = 'none';
            errorElement.classList.remove('show');
          }
        }
      }

      validateForm() {
        const formFields = this.form.querySelectorAll('input, select');
        let isValid = true;

        formFields.forEach(field => {
          if (!this.validateField(field)) {
            isValid = false;
          }
        });

        return isValid;
      }

      async handleSubmit(event) {
        event.preventDefault();

        if (!this.validateForm()) {
          this.announceToScreenReader('Form has validation errors. Please correct them before submitting.');
          // Focus first error field
          const firstError = this.form.querySelector('.error');
          if (firstError) {
            firstError.focus();
          }
          return;
        }

        // Show loading state
        this.setLoadingState(true);
        this.announceToScreenReader('Submitting form, please wait...');

        try {
          const formData = new FormData(this.form);
          const data = Object.fromEntries(formData.entries());

          // Convert string values to appropriate types
          data.monthly_income = parseFloat(data.monthly_income) || 0;
          data.monthly_expenses = parseFloat(data.monthly_expenses) || 0;
          data.current_savings = parseFloat(data.current_savings) || 0;
          data.total_debt = parseFloat(data.total_debt) || 0;
          data.risk_tolerance = parseInt(data.risk_tolerance);

          // Handle checkbox groups
          data.financial_goals = Array.from(this.form.querySelectorAll('input[name="financial_goals"]:checked'))
            .map(checkbox => checkbox.value);

          const response = await fetch('/api/financial/questionnaire', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });

          if (response.ok) {
            this.showSuccess();
            this.announceToScreenReader('Assessment submitted successfully! Your financial health score is being generated.');
            // Redirect to results page after a short delay
            setTimeout(() => {
              window.location.href = '/api/financial/questionnaire/results';
            }, 2000);
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to submit questionnaire');
          }
        } catch (error) {
          console.error('Submission error:', error);
          this.announceToScreenReader(`Error submitting form: ${error.message}`);
          alert('Failed to submit financial questionnaire. Please try again.');
        } finally {
          this.setLoadingState(false);
        }
      }

      setLoadingState(loading) {
        this.submitBtn.disabled = loading;
        this.loadingSpinner.style.display = loading ? 'inline-block' : 'none';
        this.submitBtn.innerHTML = loading 
          ? '<span class="loading" id="loadingSpinner"></span>Processing...'
          : 'Get My Financial Health Score';
        
        if (loading) {
          this.submitBtn.setAttribute('aria-busy', 'true');
        } else {
          this.submitBtn.removeAttribute('aria-busy');
        }
      }

      showSuccess() {
        this.successMessage.style.display = 'block';
        this.form.style.display = 'none';
      }

      handleKeyboardNavigation(event) {
        // Handle Enter key on form fields
        if (event.key === 'Enter' && event.target.tagName !== 'BUTTON') {
          event.preventDefault();
          const nextField = this.getNextField(event.target);
          if (nextField) {
            nextField.focus();
          }
        }
      }

      getNextField(currentField) {
        const formFields = Array.from(this.form.querySelectorAll('input, select, textarea, button'));
        const currentIndex = formFields.indexOf(currentField);
        return formFields[currentIndex + 1] || null;
      }

      announceToScreenReader(message) {
        // Create a live region for screen reader announcements
        let liveRegion = document.getElementById('screen-reader-announcements');
        if (!liveRegion) {
          liveRegion = document.createElement('div');
          liveRegion.id = 'screen-reader-announcements';
          liveRegion.setAttribute('aria-live', 'polite');
          liveRegion.setAttribute('aria-atomic', 'true');
          liveRegion.className = 'sr-only';
          document.body.appendChild(liveRegion);
        }
        
        liveRegion.textContent = message;
        
        // Clear the message after a short delay
        setTimeout(() => {
          liveRegion.textContent = '';
        }, 1000);
      }
    }

    // Initialize the questionnaire when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new FinancialQuestionnaire();
    });
  </script>
</body>
</html> 