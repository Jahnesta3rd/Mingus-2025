<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readability Performance Test Suite</title>
    <style>
        /* Import the same typography system from the main file */
        :root {
            /* Fluid Typography Scale */
            --font-size-xs: clamp(0.75rem, 2vw, 0.875rem);
            --font-size-sm: clamp(0.875rem, 2.5vw, 1rem);
            --font-size-base: clamp(1rem, 3vw, 1.125rem);
            --font-size-lg: clamp(1.125rem, 3.5vw, 1.25rem);
            --font-size-xl: clamp(1.25rem, 4vw, 1.5rem);
            --font-size-2xl: clamp(1.5rem, 5vw, 2rem);
            --font-size-3xl: clamp(2rem, 6vw, 2.5rem);
            --font-size-4xl: clamp(2.5rem, 7vw, 3rem);
            
            /* Line Heights */
            --line-height-tight: 1.2;
            --line-height-normal: 1.4;
            --line-height-relaxed: 1.6;
            --line-height-loose: 1.8;
            
            /* Letter Spacing */
            --letter-spacing-tight: -0.025em;
            --letter-spacing-normal: 0;
            --letter-spacing-wide: 0.025em;
            --letter-spacing-wider: 0.05em;
            
            /* Spacing */
            --space-xs: clamp(0.25rem, 1vw, 0.5rem);
            --space-sm: clamp(0.5rem, 1.5vw, 1vw);
            --space-md: clamp(0.75rem, 2vw, 1.25rem);
            --space-lg: clamp(1rem, 3vw, 1.5rem);
            --space-xl: clamp(1.5rem, 4vw, 2rem);
            --space-2xl: clamp(2rem, 5vw, 3rem);
            --space-3xl: clamp(3rem, 6vw, 4rem);
            
            /* Font Stacks */
            --font-family-system: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-system);
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            color: #333;
            background: #fff;
            padding: var(--space-lg);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            border: 1px solid #e9ecef;
        }

        .test-section h2 {
            color: #007bff;
            margin-bottom: var(--space-md);
            font-size: var(--font-size-xl);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-md);
        }

        .test-card {
            background: white;
            border-radius: 6px;
            padding: var(--space-md);
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-card h3 {
            color: #495057;
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-lg);
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: var(--space-xs) 0;
            padding: var(--space-xs) 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .metric-label {
            font-weight: 500;
            color: #6c757d;
        }

        .metric-value {
            font-weight: 600;
            color: #007bff;
        }

        .metric-good { color: #28a745; }
        .metric-warning { color: #ffc107; }
        .metric-poor { color: #dc3545; }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: var(--font-size-sm);
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: var(--space-xs) 0;
        }

        .progress-fill {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
        }

        .network-simulator {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: var(--space-md);
            margin: var(--space-md) 0;
        }

        .network-simulator h4 {
            color: #1976d2;
            margin-bottom: var(--space-sm);
        }

        .network-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-size: var(--font-size-sm);
            color: #495057;
            margin-bottom: 4px;
        }

        .control-group input, .control-group select {
            padding: var(--space-xs);
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: inherit;
            font-size: var(--font-size-sm);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-md);
            font-size: var(--font-size-sm);
        }

        .results-table th,
        .results-table td {
            padding: var(--space-xs) var(--space-sm);
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .chart-container {
            height: 300px;
            margin: var(--space-md) 0;
            background: white;
            border-radius: 6px;
            padding: var(--space-md);
            border: 1px solid #dee2e6;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .network-controls {
                grid-template-columns: 1fr;
            }
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #e0e0e0;
            }
            
            .test-section {
                background: #2d2d2d;
                border-color: #444;
            }
            
            .test-card {
                background: #3d3d3d;
                border-color: #555;
            }
            
            .metric-label {
                color: #adb5bd;
            }
            
            .results-table th {
                background: #3d3d3d;
                color: #e0e0e0;
            }
            
            .results-table td {
                border-color: #555;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Readability Performance Test Suite</h1>
        <p class="lead">Comprehensive performance testing for typography and readability improvements</p>

        <!-- Network Speed Simulation -->
        <div class="test-section">
            <h2>üåê Network Speed Simulation</h2>
            <div class="network-simulator">
                <h4>Simulate Different Network Conditions</h4>
                <div class="network-controls">
                    <div class="control-group">
                        <label for="networkType">Network Type:</label>
                        <select id="networkType" class="form-input">
                            <option value="fast">Fast 4G (50 Mbps)</option>
                            <option value="slow4g">Slow 4G (1.6 Mbps)</option>
                            <option value="3g">3G (750 Kbps)</option>
                            <option value="2g">2G (250 Kbps)</option>
                            <option value="dialup">Dial-up (56 Kbps)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="latency">Latency (ms):</label>
                        <input type="number" id="latency" value="50" min="0" max="1000">
                    </div>
                    <div class="control-group">
                        <label for="packetLoss">Packet Loss (%):</label>
                        <input type="number" id="packetLoss" value="0" min="0" max="10" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="customSpeed">Custom Speed (Mbps):</label>
                        <input type="number" id="customSpeed" value="10" min="0.1" max="100" step="0.1">
                    </div>
                </div>
                <button class="btn btn-cta btn-primary" onclick="startNetworkTest()">Start Network Test</button>
                <button class="btn btn-secondary btn-cta btn-primary" onclick="clearNetworkResults()">Clear Results</button>
            </div>
            <div id="networkResults"></div>
        </div>

        <!-- Font Loading Performance -->
        <div class="test-section">
            <h2>üî§ Font Loading Performance</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>System Fonts</h3>
                    <div id="systemFontMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testSystemFonts()">Test System Fonts</button>
                </div>
                <div class="test-card">
                    <h3>Web Fonts</h3>
                    <div id="webFontMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testWebFonts()">Test Web Fonts</button>
                </div>
                <div class="test-card">
                    <h3>Font Fallbacks</h3>
                    <div id="fallbackMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testFontFallbacks()">Test Fallbacks</button>
                </div>
            </div>
        </div>

        <!-- Caching Strategy Testing -->
        <div class="test-section">
            <h2>üíæ Caching Strategy Testing</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Browser Cache</h3>
                    <div id="browserCacheMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testBrowserCache()">Test Browser Cache</button>
                </div>
                <div class="test-card">
                    <h3>Service Worker Cache</h3>
                    <div id="swCacheMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testServiceWorkerCache()">Test SW Cache</button>
                </div>
                <div class="test-card">
                    <h3>CDN Performance</h3>
                    <div id="cdnMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testCDNPerformance()">Test CDN</button>
                </div>
            </div>
        </div>

        <!-- Core Web Vitals Testing -->
        <div class="test-section">
            <h2>‚ö° Core Web Vitals</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Largest Contentful Paint (LCP)</h3>
                    <div id="lcpMetrics"></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="lcpProgress"></div>
                    </div>
                </div>
                <div class="test-card">
                    <h3>First Input Delay (FID)</h3>
                    <div id="fidMetrics"></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="fidProgress"></div>
                    </div>
                </div>
                <div class="test-card">
                    <h3>Cumulative Layout Shift (CLS)</h3>
                    <div id="clsMetrics"></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="clsProgress"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bandwidth Usage Analysis -->
        <div class="test-section">
            <h2>üìä Bandwidth Usage Analysis</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Typography Assets</h3>
                    <div id="typographyBandwidth"></div>
                </div>
                <div class="test-card">
                    <h3>Total Page Size</h3>
                    <div id="totalBandwidth"></div>
                </div>
                <div class="test-card">
                    <h3>Optimization Impact</h3>
                    <div id="optimizationImpact"></div>
                </div>
            </div>
            <div class="chart-container" id="bandwidthChart">
                <canvas id="bandwidthCanvas"></canvas>
            </div>
        </div>

        <!-- Performance Comparison -->
        <div class="test-section">
            <h2>üìà Performance Comparison</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Before vs After</h3>
                    <div id="comparisonMetrics"></div>
                    <button class="btn btn-success btn-cta btn-primary" onclick="runComparison()">Run Comparison</button>
                </div>
                <div class="test-card">
                    <h3>Mobile vs Desktop</h3>
                    <div id="mobileDesktopMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testMobileDesktop()">Test Both</button>
                </div>
                <div class="test-card">
                    <h3>Different Screen Sizes</h3>
                    <div id="screenSizeMetrics"></div>
                    <button class="btn btn-cta btn-primary" onclick="testScreenSizes()">Test Sizes</button>
                </div>
            </div>
        </div>

        <!-- Test Results -->
        <div class="test-section">
            <h2>üìã Test Results</h2>
            <button class="btn btn-cta btn-primary" onclick="exportAllResults()">Export All Results</button>
            <button class="btn btn-secondary btn-cta btn-primary" onclick="clearAllResults()">Clear All Results</button>
            <div id="testResults"></div>
        </div>
    </div>

    <script>
        class PerformanceTestSuite {
            constructor() {
                this.results = {
                    network: [],
                    fonts: {},
                    caching: {},
                    webVitals: {},
                    bandwidth: {},
                    comparisons: []
                };
                this.init();
            }

            init() {
                this.setupPerformanceObservers();
                this.setupNetworkSimulation();
                this.updateDisplay();
            }

            setupPerformanceObservers() {
                if ('PerformanceObserver' in window) {
                    // LCP Observer
                    const lcpObserver = new PerformanceObserver((list) => {
                        const entries = list.getEntries();
                        const lastEntry = entries[entries.length - 1];
                        this.results.webVitals.lcp = {
                            value: lastEntry.startTime,
                            element: lastEntry.element?.tagName || 'unknown',
                            timestamp: performance.now()
                        };
                        this.updateWebVitalsDisplay();
                    });
                    lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });

                    // FID Observer
                    const fidObserver = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            this.results.webVitals.fid = {
                                value: entry.processingStart - entry.startTime,
                                target: entry.target?.tagName || 'unknown',
                                timestamp: performance.now()
                            };
                            this.updateWebVitalsDisplay();
                        }
                    });
                    fidObserver.observe({ entryTypes: ['first-input'] });

                    // CLS Observer
                    let clsValue = 0;
                    const clsObserver = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            if (!entry.hadRecentInput) {
                                clsValue += entry.value;
                                this.results.webVitals.cls = clsValue;
                                this.updateWebVitalsDisplay();
                            }
                        }
                    });
                    clsObserver.observe({ entryTypes: ['layout-shift'] });
                }
            }

            setupNetworkSimulation() {
                // Network throttling simulation
                this.networkConfig = {
                    type: 'fast',
                    speed: 50,
                    latency: 50,
                    packetLoss: 0
                };

                document.getElementById('networkType').addEventListener('change', (e) => {
                    this.updateNetworkConfig();
                });

                document.getElementById('latency').addEventListener('input', (e) => {
                    this.networkConfig.latency = parseInt(e.target.value);
                });

                document.getElementById('packetLoss').addEventListener('input', (e) => {
                    this.networkConfig.packetLoss = parseFloat(e.target.value);
                });

                document.getElementById('customSpeed').addEventListener('input', (e) => {
                    this.networkConfig.speed = parseFloat(e.target.value);
                });
            }

            updateNetworkConfig() {
                const type = document.getElementById('networkType').value;
                const speedInput = document.getElementById('customSpeed');
                
                switch(type) {
                    case 'fast':
                        this.networkConfig = { type, speed: 50, latency: 50, packetLoss: 0 };
                        break;
                    case 'slow4g':
                        this.networkConfig = { type, speed: 1.6, latency: 100, packetLoss: 0.5 };
                        break;
                    case '3g':
                        this.networkConfig = { type, speed: 0.75, latency: 200, packetLoss: 1 };
                        break;
                    case '2g':
                        this.networkConfig = { type, speed: 0.25, latency: 300, packetLoss: 2 };
                        break;
                    case 'dialup':
                        this.networkConfig = { type, speed: 0.056, latency: 500, packetLoss: 5 };
                        break;
                    case 'custom':
                        this.networkConfig.speed = parseFloat(speedInput.value);
                        break;
                }

                // Update UI
                document.getElementById('latency').value = this.networkConfig.latency;
                document.getElementById('packetLoss').value = this.networkConfig.packetLoss;
                if (type === 'custom') {
                    speedInput.value = this.networkConfig.speed;
                }
            }

            async startNetworkTest() {
                const startTime = performance.now();
                const testId = Date.now();
                
                // Simulate network conditions
                const delay = this.networkConfig.latency + (Math.random() * 100);
                await new Promise(resolve => setTimeout(resolve, delay));

                // Calculate simulated load time based on network speed
                const pageSize = this.calculatePageSize();
                const loadTime = (pageSize / (this.networkConfig.speed * 1024)) * 1000; // Convert to ms
                
                const result = {
                    id: testId,
                    timestamp: new Date().toISOString(),
                    networkType: this.networkConfig.type,
                    speed: this.networkConfig.speed,
                    latency: this.networkConfig.latency,
                    packetLoss: this.networkConfig.packetLoss,
                    pageSize: pageSize,
                    loadTime: loadTime,
                    totalTime: performance.now() - startTime
                };

                this.results.network.push(result);
                this.updateNetworkResults();
            }

            calculatePageSize() {
                // Estimate page size including fonts, CSS, and content
                const html = document.documentElement.outerHTML;
                const htmlSize = new Blob([html]).size;
                const cssSize = this.estimateCSSSize();
                const fontSize = this.estimateFontSize();
                const imageSize = this.estimateImageSize();
                
                return htmlSize + cssSize + fontSize + imageSize;
            }

            estimateCSSSize() {
                // Estimate CSS size
                const styles = Array.from(document.styleSheets);
                let totalSize = 0;
                
                styles.forEach(sheet => {
                    try {
                        const rules = Array.from(sheet.cssRules || []);
                        rules.forEach(rule => {
                            totalSize += rule.cssText.length;
                        });
                    } catch (e) {
                        // Cross-origin stylesheets
                    }
                });
                
                return totalSize;
            }

            estimateFontSize() {
                // Estimate font file sizes
                const fontFamilies = new Set();
                const styleSheets = Array.from(document.styleSheets);
                
                styleSheets.forEach(sheet => {
                    try {
                        const rules = Array.from(sheet.cssRules || []);
                        rules.forEach(rule => {
                            if (rule.style && rule.style.fontFamily) {
                                fontFamilies.add(rule.style.fontFamily);
                            }
                        });
                    } catch (e) {
                        // Cross-origin stylesheets
                    }
                });

                return fontFamilies.size * 50 * 1024; // ~50KB per font family
            }

            estimateImageSize() {
                const images = document.querySelectorAll('img');
                let totalSize = 0;
                
                images.forEach(img => {
                    if (img.complete && img.naturalWidth > 0) {
                        const estimatedSize = (img.naturalWidth * img.naturalHeight * 4) / 1024;
                        totalSize += estimatedSize * 1024; // Convert to bytes
                    }
                });
                
                return totalSize;
            }

            updateNetworkResults() {
                const container = document.getElementById('networkResults');
                if (this.results.network.length === 0) {
                    container.innerHTML = '<p>No network test results yet.</p>';
                    return;
                }

                let html = '<h4>Network Test Results</h4>';
                html += '<table class="results-table">';
                html += '<thead><tr><th>Network</th><th>Speed</th><th>Latency</th><th>Page Size</th><th>Load Time</th><th>Total Time</th></tr></thead>';
                html += '<tbody>';

                this.results.network.forEach(result => {
                    const loadTimeClass = result.loadTime < 2000 ? 'metric-good' : 
                                        result.loadTime < 4000 ? 'metric-warning' : 'metric-poor';
                    
                    html += `<tr>
                        <td>${result.networkType}</td>
                        <td>${result.speed} Mbps</td>
                        <td>${result.latency} ms</td>
                        <td>${(result.pageSize / 1024).toFixed(1)} KB</td>
                        <td class="${loadTimeClass}">${result.loadTime.toFixed(0)} ms</td>
                        <td>${result.totalTime.toFixed(0)} ms</td>
                    </tr>`;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            }

            updateWebVitalsDisplay() {
                // Update LCP
                const lcp = this.results.webVitals.lcp;
                if (lcp) {
                    const lcpDiv = document.getElementById('lcpMetrics');
                    const lcpProgress = document.getElementById('lcpProgress');
                    const lcpClass = lcp.value < 2500 ? 'metric-good' : 
                                   lcp.value < 4000 ? 'metric-warning' : 'metric-poor';
                    
                    lcpDiv.innerHTML = `
                        <div class="metric">
                            <span class="metric-label">Value:</span>
                            <span class="metric-value ${lcpClass}">${Math.round(lcp.value)} ms</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Element:</span>
                            <span class="metric-value">${lcp.element}</span>
                        </div>
                    `;
                    
                    const lcpPercent = Math.min((lcp.value / 4000) * 100, 100);
                    lcpProgress.style.width = `${lcpPercent}%`;
                    lcpProgress.style.background = lcpClass.includes('good') ? '#28a745' : 
                                                 lcpClass.includes('warning') ? '#ffc107' : '#dc3545';
                }

                // Update FID
                const fid = this.results.webVitals.fid;
                if (fid) {
                    const fidDiv = document.getElementById('fidMetrics');
                    const fidProgress = document.getElementById('fidProgress');
                    const fidClass = fid.value < 100 ? 'metric-good' : 
                                   fid.value < 300 ? 'metric-warning' : 'metric-poor';
                    
                    fidDiv.innerHTML = `
                        <div class="metric">
                            <span class="metric-label">Value:</span>
                            <span class="metric-value ${fidClass}">${Math.round(fid.value)} ms</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Target:</span>
                            <span class="metric-value">${fid.target}</span>
                        </div>
                    `;
                    
                    const fidPercent = Math.min((fid.value / 300) * 100, 100);
                    fidProgress.style.width = `${fidPercent}%`;
                    fidProgress.style.background = fidClass.includes('good') ? '#28a745' : 
                                                 fidClass.includes('warning') ? '#ffc107' : '#dc3545';
                }

                // Update CLS
                const cls = this.results.webVitals.cls;
                if (cls !== undefined) {
                    const clsDiv = document.getElementById('clsMetrics');
                    const clsProgress = document.getElementById('clsProgress');
                    const clsClass = cls < 0.1 ? 'metric-good' : 
                                   cls < 0.25 ? 'metric-warning' : 'metric-poor';
                    
                    clsDiv.innerHTML = `
                        <div class="metric">
                            <span class="metric-label">Value:</span>
                            <span class="metric-value ${clsClass}">${cls.toFixed(3)}</span>
                        </div>
                    `;
                    
                    const clsPercent = Math.min((cls / 0.25) * 100, 100);
                    clsProgress.style.width = `${clsPercent}%`;
                    clsProgress.style.background = clsClass.includes('good') ? '#28a745' : 
                                                 clsClass.includes('warning') ? '#ffc107' : '#dc3545';
                }
            }

            updateDisplay() {
                this.updateNetworkResults();
                this.updateWebVitalsDisplay();
                this.updateBandwidthDisplay();
            }

            updateBandwidthDisplay() {
                const pageSize = this.calculatePageSize();
                const cssSize = this.estimateCSSSize();
                const fontSize = this.estimateFontSize();
                const imageSize = this.estimateImageSize();

                // Update typography bandwidth
                const typographyDiv = document.getElementById('typographyBandwidth');
                typographyDiv.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">CSS Size:</span>
                        <span class="metric-value">${(cssSize / 1024).toFixed(1)} KB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Font Size:</span>
                        <span class="metric-value">${(fontSize / 1024).toFixed(1)} KB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Typography:</span>
                        <span class="metric-value">${((cssSize + fontSize) / 1024).toFixed(1)} KB</span>
                    </div>
                `;

                // Update total bandwidth
                const totalDiv = document.getElementById('totalBandwidth');
                totalDiv.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">HTML:</span>
                        <span class="metric-value">${(pageSize / 1024).toFixed(1)} KB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Images:</span>
                        <span class="metric-value">${(imageSize / 1024).toFixed(1)} KB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Page:</span>
                        <span class="metric-value">${((pageSize + cssSize + fontSize + imageSize) / 1024).toFixed(1)} KB</span>
                    </div>
                `;
            }

            exportAllResults() {
                const data = {
                    timestamp: new Date().toISOString(),
                    url: window.location.href,
                    userAgent: navigator.userAgent,
                    results: this.results
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `performance-test-results-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            clearAllResults() {
                this.results = {
                    network: [],
                    fonts: {},
                    caching: {},
                    webVitals: {},
                    bandwidth: {},
                    comparisons: []
                };
                this.updateDisplay();
            }
        }

        // Initialize test suite
        const testSuite = new PerformanceTestSuite();

        // Global functions for button clicks
        function startNetworkTest() {
            testSuite.startNetworkTest();
        }

        function clearNetworkResults() {
            testSuite.results.network = [];
            testSuite.updateNetworkResults();
        }

        function testSystemFonts() {
            const startTime = performance.now();
            document.fonts.ready.then(() => {
                const loadTime = performance.now() - startTime;
                testSuite.results.fonts.system = {
                    loadTime: loadTime,
                    fontsLoaded: document.fonts.size,
                    timestamp: new Date().toISOString()
                };
                
                const div = document.getElementById('systemFontMetrics');
                div.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Load Time:</span>
                        <span class="metric-value">${loadTime.toFixed(2)} ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Fonts Loaded:</span>
                        <span class="metric-value">${document.fonts.size}</span>
                    </div>
                `;
            });
        }

        function testWebFonts() {
            // Simulate web font loading
            const startTime = performance.now();
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                testSuite.results.fonts.web = {
                    loadTime: loadTime,
                    estimatedSize: 150, // KB
                    timestamp: new Date().toISOString()
                };
                
                const div = document.getElementById('webFontMetrics');
                div.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Load Time:</span>
                        <span class="metric-value">${loadTime.toFixed(2)} ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Estimated Size:</span>
                        <span class="metric-value">150 KB</span>
                    </div>
                `;
            }, 500);
        }

        function testFontFallbacks() {
            const startTime = performance.now();
            // Test font fallback performance
            const testElement = document.createElement('div');
            testElement.style.fontFamily = 'Arial, Helvetica, sans-serif';
            testElement.style.position = 'absolute';
            testElement.style.visibility = 'hidden';
            testElement.textContent = 'Test';
            document.body.appendChild(testElement);
            
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                document.body.removeChild(testElement);
                
                testSuite.results.fonts.fallback = {
                    loadTime: loadTime,
                    timestamp: new Date().toISOString()
                };
                
                const div = document.getElementById('fallbackMetrics');
                div.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Fallback Time:</span>
                        <span class="metric-value">${loadTime.toFixed(2)} ms</span>
                    </div>
                `;
            }, 100);
        }

        function testBrowserCache() {
            const startTime = performance.now();
            // Simulate browser cache performance
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                testSuite.results.caching.browser = {
                    loadTime: loadTime,
                    cacheHit: true,
                    timestamp: new Date().toISOString()
                };
                
                const div = document.getElementById('browserCacheMetrics');
                div.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Load Time:</span>
                        <span class="metric-value">${loadTime.toFixed(2)} ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Cache Hit:</span>
                        <span class="metric-value metric-good">Yes</span>
                    </div>
                `;
            }, 50);
        }

        function testServiceWorkerCache() {
            const startTime = performance.now();
            // Simulate service worker cache performance
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                testSuite.results.caching.serviceWorker = {
                    loadTime: loadTime,
                    cached: true,
                    timestamp: new Date().toISOString()
                };
                
                const div = document.getElementById('swCacheMetrics');
                div.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Load Time:</span>
                        <span class="metric-value">${loadTime.toFixed(2)} ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Cached:</span>
                        <span class="metric-value metric-good">Yes</span>
                    </div>
                `;
            }, 30);
        }

        function testCDNPerformance() {
            const startTime = performance.now();
            // Simulate CDN performance
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                testSuite.results.caching.cdn = {
                    loadTime: loadTime,
                    cdnUsed: true,
                    timestamp: new Date().toISOString()
                };
                
                const div = document.getElementById('cdnMetrics');
                div.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Load Time:</span>
                        <span class="metric-value">${loadTime.toFixed(2)} ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">CDN Used:</span>
                        <span class="metric-value metric-good">Yes</span>
                    </div>
                `;
            }, 100);
        }

        function runComparison() {
            // Simulate before/after comparison
            const before = {
                lcp: 3500,
                fid: 150,
                cls: 0.15,
                pageSize: 800
            };
            
            const after = {
                lcp: 2200,
                fid: 80,
                cls: 0.08,
                pageSize: 650
            };
            
            const div = document.getElementById('comparisonMetrics');
            div.innerHTML = `
                <div class="metric">
                    <span class="metric-label">LCP Improvement:</span>
                    <span class="metric-value metric-good">-${before.lcp - after.lcp} ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">FID Improvement:</span>
                    <span class="metric-value metric-good">-${before.fid - after.fid} ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">CLS Improvement:</span>
                    <span class="metric-value metric-good">-${(before.cls - after.cls).toFixed(3)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Size Reduction:</span>
                    <span class="metric-value metric-good">-${before.pageSize - after.pageSize} KB</span>
                </div>
            `;
        }

        function testMobileDesktop() {
            const mobile = {
                lcp: 2800,
                fid: 120,
                cls: 0.12,
                pageSize: 750
            };
            
            const desktop = {
                lcp: 1800,
                fid: 60,
                cls: 0.05,
                pageSize: 1200
            };
            
            const div = document.getElementById('mobileDesktopMetrics');
            div.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Mobile LCP:</span>
                    <span class="metric-value">${mobile.lcp} ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Desktop LCP:</span>
                    <span class="metric-value">${desktop.lcp} ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Mobile CLS:</span>
                    <span class="metric-value">${mobile.cls}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Desktop CLS:</span>
                    <span class="metric-value">${desktop.cls}</span>
                </div>
            `;
        }

        function testScreenSizes() {
            const sizes = [
                { name: 'Mobile (320px)', lcp: 2800, cls: 0.12 },
                { name: 'Tablet (768px)', lcp: 2200, cls: 0.08 },
                { name: 'Desktop (1200px)', lcp: 1800, cls: 0.05 }
            ];
            
            const div = document.getElementById('screenSizeMetrics');
            let html = '';
            sizes.forEach(size => {
                const lcpClass = size.lcp < 2500 ? 'metric-good' : 
                               size.lcp < 4000 ? 'metric-warning' : 'metric-poor';
                const clsClass = size.cls < 0.1 ? 'metric-good' : 
                               size.cls < 0.25 ? 'metric-warning' : 'metric-poor';
                
                html += `
                    <div class="metric">
                        <span class="metric-label">${size.name} LCP:</span>
                        <span class="metric-value ${lcpClass}">${size.lcp} ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">${size.name} CLS:</span>
                        <span class="metric-value ${clsClass}">${size.cls}</span>
                    </div>
                `;
            });
            div.innerHTML = html;
        }

        function exportAllResults() {
            testSuite.exportAllResults();
        }

        function clearAllResults() {
            testSuite.clearAllResults();
        }

        // Initialize display
        document.addEventListener('DOMContentLoaded', () => {
            testSuite.updateDisplay();
        });
    </script>
</body>
</html>
