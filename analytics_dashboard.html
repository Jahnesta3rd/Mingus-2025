<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readability Analytics Dashboard</title>
    <style>
        /* Import the same typography system */
        :root {
            --font-size-xs: clamp(0.75rem, 2vw, 0.875rem);
            --font-size-sm: clamp(0.875rem, 2.5vw, 1rem);
            --font-size-base: clamp(1rem, 3vw, 1.125rem);
            --font-size-lg: clamp(1.125rem, 3.5vw, 1.25rem);
            --font-size-xl: clamp(1.25rem, 4vw, 1.5rem);
            --font-size-2xl: clamp(1.5rem, 5vw, 2rem);
            --font-size-3xl: clamp(2rem, 6vw, 2.5rem);
            --font-size-4xl: clamp(2.5rem, 7vw, 3rem);
            
            --line-height-tight: 1.2;
            --line-height-normal: 1.4;
            --line-height-relaxed: 1.6;
            --line-height-loose: 1.8;
            
            --letter-spacing-tight: -0.025em;
            --letter-spacing-normal: 0;
            --letter-spacing-wide: 0.025em;
            --letter-spacing-wider: 0.05em;
            
            --space-xs: clamp(0.25rem, 1vw, 0.5rem);
            --space-sm: clamp(0.5rem, 1.5vw, 1vw);
            --space-md: clamp(0.75rem, 2vw, 1.25rem);
            --space-lg: clamp(1rem, 3vw, 1.5rem);
            --space-xl: clamp(1.5rem, 4vw, 2rem);
            --space-2xl: clamp(2rem, 5vw, 3rem);
            --space-3xl: clamp(3rem, 6vw, 4rem);
            
            --font-family-system: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-system);
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            color: #333;
            background: #f8f9fa;
            padding: var(--space-lg);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-header {
            background: white;
            border-radius: 8px;
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .dashboard-header h1 {
            color: #007bff;
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-3xl);
        }

        .dashboard-header p {
            color: #6c757d;
            font-size: var(--font-size-lg);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            padding: var(--space-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }

        .metric-card h3 {
            color: #495057;
            margin-bottom: var(--space-md);
            font-size: var(--font-size-lg);
        }

        .metric-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: #007bff;
            margin-bottom: var(--space-xs);
        }

        .metric-label {
            color: #6c757d;
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-sm);
        }

        .metric-change {
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .metric-change.positive {
            color: #28a745;
        }

        .metric-change.negative {
            color: #dc3545;
        }

        .metric-change.neutral {
            color: #6c757d;
        }

        .chart-container {
            background: white;
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-container h2 {
            color: #495057;
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-xl);
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-lg);
        }

        .chart {
            height: 300px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: var(--space-md);
            position: relative;
        }

        .heatmap-container {
            background: white;
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .heatmap-canvas {
            width: 100%;
            height: 400px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }

        .controls {
            background: white;
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .controls h2 {
            color: #495057;
            margin-bottom: var(--space-md);
            font-size: var(--font-size-xl);
        }

        .control-group {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
            flex-wrap: wrap;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            min-width: 120px;
        }

        .control-group select,
        .control-group input {
            padding: var(--space-xs) var(--space-sm);
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: inherit;
            font-size: var(--font-size-sm);
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: var(--font-size-sm);
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: var(--space-xs) 0;
        }

        .progress-fill {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
        }

        .progress-fill.success {
            background: #28a745;
        }

        .progress-fill.warning {
            background: #ffc107;
        }

        .progress-fill.danger {
            background: #dc3545;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-md);
        }

        .comparison-table th,
        .comparison-table td {
            padding: var(--space-sm);
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .comparison-table .improvement {
            color: #28a745;
            font-weight: 600;
        }

        .comparison-table .decline {
            color: #dc3545;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
            }
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #e0e0e0;
            }
            
            .dashboard-header,
            .metric-card,
            .chart-container,
            .heatmap-container,
            .controls {
                background: #2d2d2d;
                border-color: #444;
            }
            
            .metric-card {
                border-left-color: #4dabf7;
            }
            
            .comparison-table th {
                background: #3d3d3d;
                color: #e0e0e0;
            }
            
            .comparison-table td {
                border-color: #555;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="dashboard-header">
            <h1>ðŸ“Š Readability Analytics Dashboard</h1>
            <p>Comprehensive tracking of readability improvement success metrics</p>
        </div>

        <!-- Key Metrics Overview -->
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>Mobile Bounce Rate</h3>
                <div class="metric-value" id="bounce-rate">--</div>
                <div class="metric-label">Percentage of single-page sessions</div>
                <div class="metric-change" id="bounce-rate-change">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="bounce-rate-progress"></div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Time on Page</h3>
                <div class="metric-value" id="time-on-page">--</div>
                <div class="metric-label">Average session duration</div>
                <div class="metric-change" id="time-on-page-change">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="time-on-page-progress"></div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Mobile Conversion Rate</h3>
                <div class="metric-value" id="conversion-rate">--</div>
                <div class="metric-label">Percentage of goal completions</div>
                <div class="metric-change" id="conversion-rate-change">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="conversion-rate-progress"></div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Form Completion Rate</h3>
                <div class="metric-value" id="form-completion">--</div>
                <div class="metric-label">Percentage of forms completed</div>
                <div class="metric-change" id="form-completion-change">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="form-completion-progress"></div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Accessibility Score</h3>
                <div class="metric-value" id="accessibility-score">--</div>
                <div class="metric-label">WCAG compliance percentage</div>
                <div class="metric-change" id="accessibility-score-change">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="accessibility-score-progress"></div>
                </div>
            </div>

            <div class="metric-card">
                <h3>User Engagement</h3>
                <div class="metric-value" id="user-engagement">--</div>
                <div class="metric-label">Active time vs total time</div>
                <div class="metric-change" id="user-engagement-change">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="user-engagement-progress"></div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <h2>ðŸ“ˆ Analytics Controls</h2>
            <div class="control-group">
                <label for="timeRange">Time Range:</label>
                <select id="timeRange" class="form-input">
                    <option value="7d">Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                    <option value="1y">Last Year</option>
                </select>
            </div>
            <div class="control-group">
                <label for="deviceType">Device Type:</label>
                <select id="deviceType" class="form-input">
                    <option value="all">All Devices</option>
                    <option value="mobile">Mobile Only</option>
                    <option value="tablet">Tablet Only</option>
                    <option value="desktop">Desktop Only</option>
                </select>
            </div>
            <div class="control-group">
                <button class="btn btn-cta btn-primary" onclick="dashboard.refreshData()">Refresh Data</button>
                <button class="btn btn-secondary btn-cta btn-primary" onclick="dashboard.exportReport()">Export Report</button>
                <button class="btn btn-success btn-cta btn-primary" onclick="dashboard.compareBaseline()">Compare Baseline</button>
            </div>
        </div>

        <!-- Charts -->
        <div class="chart-container">
            <h2>ðŸ“Š Performance Trends</h2>
            <div class="chart-grid">
                <div class="chart" id="bounce-rate-chart">
                    <canvas id="bounceRateCanvas"></canvas>
                </div>
                <div class="chart" id="time-on-page-chart">
                    <canvas id="timeOnPageCanvas"></canvas>
                </div>
                <div class="chart" id="conversion-rate-chart">
                    <canvas id="conversionRateCanvas"></canvas>
                </div>
                <div class="chart" id="accessibility-score-chart">
                    <canvas id="accessibilityScoreCanvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Heatmap -->
        <div class="heatmap-container">
            <h2>ðŸ”¥ User Interaction Heatmap</h2>
            <div class="heatmap-canvas" id="heatmap-canvas">
                <canvas id="heatmapCanvas"></canvas>
            </div>
            <div class="control-group" style="margin-top: var(--space-md);">
                <label for="heatmapType">Heatmap Type:</label>
                <select id="heatmapType" class="form-input">
                    <option value="clicks">Clicks</option>
                    <option value="movements">Mouse Movements</option>
                    <option value="scroll">Scroll Depth</option>
                    <option value="attention">Attention Areas</option>
                </select>
                <button class="btn btn-cta btn-primary" onclick="dashboard.updateHeatmap()">Update Heatmap</button>
            </div>
        </div>

        <!-- Baseline Comparison -->
        <div class="chart-container">
            <h2>ðŸ“‹ Baseline Comparison</h2>
            <table class="comparison-table" id="comparison-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Before</th>
                        <th>After</th>
                        <th>Change</th>
                        <th>Improvement</th>
                    </tr>
                </thead>
                <tbody id="comparison-tbody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        class ReadabilityDashboard {
            constructor() {
                this.data = {
                    baseline: {},
                    current: {},
                    trends: {},
                    heatmap: {}
                };
                this.charts = {};
                this.init();
            }

            init() {
                this.loadData();
                this.setupCharts();
                this.setupHeatmap();
                this.updateMetrics();
                this.setupEventListeners();
            }

            loadData() {
                // Load analytics data from localStorage or API
                const savedData = localStorage.getItem('readability_analytics_data');
                if (savedData) {
                    this.data = JSON.parse(savedData);
                } else {
                    // Generate sample data for demonstration
                    this.generateSampleData();
                }
            }

            generateSampleData() {
                // Generate sample data for demonstration
                const now = Date.now();
                const dayMs = 24 * 60 * 60 * 1000;

                this.data.baseline = {
                    bounceRate: 65,
                    timeOnPage: 45,
                    conversionRate: 2.1,
                    formCompletion: 68,
                    accessibilityScore: 72,
                    userEngagement: 58
                };

                this.data.current = {
                    bounceRate: 42,
                    timeOnPage: 78,
                    conversionRate: 3.8,
                    formCompletion: 85,
                    accessibilityScore: 94,
                    userEngagement: 82
                };

                // Generate trend data
                this.data.trends = {
                    bounceRate: this.generateTrendData(65, 42, 30),
                    timeOnPage: this.generateTrendData(45, 78, 30),
                    conversionRate: this.generateTrendData(2.1, 3.8, 30),
                    accessibilityScore: this.generateTrendData(72, 94, 30)
                };

                // Generate heatmap data
                this.data.heatmap = this.generateHeatmapData();
            }

            generateTrendData(startValue, endValue, days) {
                const data = [];
                for (let i = 0; i < days; i++) {
                    const progress = i / (days - 1);
                    const value = startValue + (endValue - startValue) * progress;
                    data.push({
                        date: new Date(Date.now() - (days - i) * 24 * 60 * 60 * 1000),
                        value: value + (Math.random() - 0.5) * 10
                    });
                }
                return data;
            }

            generateHeatmapData() {
                const data = [];
                const width = 800;
                const height = 600;

                // Generate click data
                for (let i = 0; i < 100; i++) {
                    data.push({
                        type: 'click',
                        x: Math.random() * width,
                        y: Math.random() * height,
                        intensity: Math.random()
                    });
                }

                // Generate movement data
                for (let i = 0; i < 500; i++) {
                    data.push({
                        type: 'movement',
                        x: Math.random() * width,
                        y: Math.random() * height,
                        intensity: Math.random() * 0.5
                    });
                }

                return data;
            }

            setupCharts() {
                // Setup Chart.js charts
                this.setupBounceRateChart();
                this.setupTimeOnPageChart();
                this.setupConversionRateChart();
                this.setupAccessibilityScoreChart();
            }

            setupBounceRateChart() {
                const ctx = document.getElementById('bounceRateCanvas').getContext('2d');
                this.charts.bounceRate = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.data.trends.bounceRate.map(d => d.date.toLocaleDateString()),
                        datasets: [{
                            label: 'Bounce Rate (%)',
                            data: this.data.trends.bounceRate.map(d => d.value),
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Bounce Rate Trend'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            setupTimeOnPageChart() {
                const ctx = document.getElementById('timeOnPageCanvas').getContext('2d');
                this.charts.timeOnPage = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.data.trends.timeOnPage.map(d => d.date.toLocaleDateString()),
                        datasets: [{
                            label: 'Time on Page (seconds)',
                            data: this.data.trends.timeOnPage.map(d => d.value),
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Time on Page Trend'
                            }
                        }
                    }
                });
            }

            setupConversionRateChart() {
                const ctx = document.getElementById('conversionRateCanvas').getContext('2d');
                this.charts.conversionRate = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.data.trends.conversionRate.map(d => d.date.toLocaleDateString()),
                        datasets: [{
                            label: 'Conversion Rate (%)',
                            data: this.data.trends.conversionRate.map(d => d.value),
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Conversion Rate Trend'
                            }
                        }
                    }
                });
            }

            setupAccessibilityScoreChart() {
                const ctx = document.getElementById('accessibilityScoreCanvas').getContext('2d');
                this.charts.accessibilityScore = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.data.trends.accessibilityScore.map(d => d.date.toLocaleDateString()),
                        datasets: [{
                            label: 'Accessibility Score (%)',
                            data: this.data.trends.accessibilityScore.map(d => d.value),
                            borderColor: '#ffc107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Accessibility Score Trend'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            setupHeatmap() {
                const canvas = document.getElementById('heatmapCanvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;

                this.drawHeatmap(ctx, canvas.width, canvas.height);
            }

            drawHeatmap(ctx, width, height) {
                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Draw heatmap
                const heatmapType = document.getElementById('heatmapType').value;
                const data = this.data.heatmap.filter(d => d.type === heatmapType);

                data.forEach(point => {
                    const x = (point.x / 800) * width;
                    const y = (point.y / 600) * height;
                    const radius = point.intensity * 50 + 10;
                    const alpha = point.intensity * 0.8 + 0.2;

                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, 2 * Math.PI);
                    ctx.fillStyle = `rgba(255, 0, 0, ${alpha})`;
                    ctx.fill();
                });
            }

            updateMetrics() {
                // Update metric displays
                this.updateMetric('bounce-rate', this.data.current.bounceRate, this.data.baseline.bounceRate, '%', true);
                this.updateMetric('time-on-page', this.data.current.timeOnPage, this.data.baseline.timeOnPage, 's', false);
                this.updateMetric('conversion-rate', this.data.current.conversionRate, this.data.baseline.conversionRate, '%', false);
                this.updateMetric('form-completion', this.data.current.formCompletion, this.data.baseline.formCompletion, '%', false);
                this.updateMetric('accessibility-score', this.data.current.accessibilityScore, this.data.baseline.accessibilityScore, '%', false);
                this.updateMetric('user-engagement', this.data.current.userEngagement, this.data.baseline.userEngagement, '%', false);
            }

            updateMetric(elementId, currentValue, baselineValue, unit, lowerIsBetter) {
                const element = document.getElementById(elementId);
                const changeElement = document.getElementById(elementId + '-change');
                const progressElement = document.getElementById(elementId + '-progress');

                if (element) {
                    element.textContent = currentValue.toFixed(1) + unit;
                }

                if (changeElement) {
                    const change = currentValue - baselineValue;
                    const changePercent = (change / baselineValue) * 100;
                    
                    if (lowerIsBetter) {
                        change = -change;
                        changePercent = -changePercent;
                    }

                    const changeText = `${change > 0 ? '+' : ''}${change.toFixed(1)}${unit} (${changePercent > 0 ? '+' : ''}${changePercent.toFixed(1)}%)`;
                    changeElement.textContent = changeText;
                    changeElement.className = `metric-change ${change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral'}`;
                }

                if (progressElement) {
                    const maxValue = Math.max(currentValue, baselineValue) * 1.2;
                    const progress = (currentValue / maxValue) * 100;
                    progressElement.style.width = `${progress}%`;
                    
                    // Set color based on performance
                    if (lowerIsBetter) {
                        progressElement.className = `progress-fill ${currentValue < 50 ? 'success' : currentValue < 70 ? 'warning' : 'danger'}`;
                    } else {
                        progressElement.className = `progress-fill ${currentValue > 80 ? 'success' : currentValue > 60 ? 'warning' : 'danger'}`;
                    }
                }
            }

            updateComparisonTable() {
                const tbody = document.getElementById('comparison-tbody');
                const metrics = [
                    { name: 'Bounce Rate', current: this.data.current.bounceRate, baseline: this.data.baseline.bounceRate, unit: '%', lowerIsBetter: true },
                    { name: 'Time on Page', current: this.data.current.timeOnPage, baseline: this.data.baseline.timeOnPage, unit: 's', lowerIsBetter: false },
                    { name: 'Conversion Rate', current: this.data.current.conversionRate, baseline: this.data.baseline.conversionRate, unit: '%', lowerIsBetter: false },
                    { name: 'Form Completion', current: this.data.current.formCompletion, baseline: this.data.baseline.formCompletion, unit: '%', lowerIsBetter: false },
                    { name: 'Accessibility Score', current: this.data.current.accessibilityScore, baseline: this.data.baseline.accessibilityScore, unit: '%', lowerIsBetter: false },
                    { name: 'User Engagement', current: this.data.current.userEngagement, baseline: this.data.baseline.userEngagement, unit: '%', lowerIsBetter: false }
                ];

                tbody.innerHTML = metrics.map(metric => {
                    const change = metric.current - metric.baseline;
                    const changePercent = (change / metric.baseline) * 100;
                    const isImprovement = metric.lowerIsBetter ? change < 0 : change > 0;
                    
                    return `
                        <tr>
                            <td>${metric.name}</td>
                            <td>${metric.baseline.toFixed(1)}${metric.unit}</td>
                            <td>${metric.current.toFixed(1)}${metric.unit}</td>
                            <td class="${isImprovement ? 'improvement' : 'decline'}">
                                ${change > 0 ? '+' : ''}${change.toFixed(1)}${metric.unit}
                            </td>
                            <td class="${isImprovement ? 'improvement' : 'decline'}">
                                ${changePercent > 0 ? '+' : ''}${changePercent.toFixed(1)}%
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            setupEventListeners() {
                document.getElementById('timeRange').addEventListener('change', () => this.refreshData());
                document.getElementById('deviceType').addEventListener('change', () => this.refreshData());
            }

            refreshData() {
                // Refresh data based on selected filters
                this.loadData();
                this.updateMetrics();
                this.updateComparisonTable();
                this.updateCharts();
            }

            updateCharts() {
                // Update chart data
                Object.values(this.charts).forEach(chart => {
                    chart.update();
                });
            }

            updateHeatmap() {
                this.setupHeatmap();
            }

            exportReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    data: this.data,
                    filters: {
                        timeRange: document.getElementById('timeRange').value,
                        deviceType: document.getElementById('deviceType').value
                    }
                };

                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `readability-analytics-report-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            compareBaseline() {
                this.updateComparisonTable();
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Load Chart.js if not already loaded
            if (typeof Chart === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = () => {
                    window.dashboard = new ReadabilityDashboard();
                };
                document.head.appendChild(script);
            } else {
                window.dashboard = new ReadabilityDashboard();
            }
        });
    </script>
</body>
</html>
