<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Recommendations - Mingus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .opportunity-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            margin-bottom: 20px;
        }
        .opportunity-card:hover {
            transform: translateY(-2px);
        }
        .conservative {
            border-left: 5px solid #28a745;
        }
        .optimal {
            border-left: 5px solid #007bff;
        }
        .stretch {
            border-left: 5px solid #dc3545;
        }
        .salary-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .success-probability {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        .high-probability { background: #28a745; }
        .medium-probability { background: #ffc107; color: #212529; }
        .low-probability { background: #dc3545; }
        .financial-impact {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
        }
        .action-plan {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .skill-gap {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .timeline-item {
            border-left: 3px solid #007bff;
            padding-left: 20px;
            margin-bottom: 15px;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            width: 12px;
            height: 12px;
            background: #007bff;
            border-radius: 50%;
            position: absolute;
            left: -7px;
            top: 5px;
        }
        .profile-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
        }
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        .btn-action {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 500;
        }
        .progress-custom {
            height: 8px;
            border-radius: 4px;
        }
        .skill-tag {
            display: inline-block;
            background: #e9ecef;
            color: #495057;
            padding: 5px 10px;
            border-radius: 15px;
            margin: 2px;
            font-size: 0.9em;
        }
        .skill-tag.missing {
            background: #f8d7da;
            color: #721c24;
        }
        .company-badge {
            background: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .location-badge {
            background: #6c757d;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="container mt-4">
                    <!-- Header -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h1 class="text-center mb-3">
                                <i class="fas fa-chart-line text-primary"></i>
                                Your Personalized Job Recommendations
                            </h1>
                            <p class="text-center text-muted">
                                Based on your resume analysis and career preferences
                            </p>
                        </div>
                    </div>

                    <!-- Profile Summary -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="profile-summary">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value" id="fieldExpertise">Data Analysis</div>
                                            <div class="metric-label">Primary Field</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value" id="experienceLevel">Senior</div>
                                            <div class="metric-label">Experience Level</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value" id="currentPercentile">65%</div>
                                            <div class="metric-label">Current Percentile</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value" id="leadershipPotential">75%</div>
                                            <div class="metric-label">Leadership Potential</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Impact -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="financial-impact">
                                <h4><i class="fas fa-dollar-sign"></i> Financial Impact Analysis</h4>
                                <div class="row">
                                    <div class="col-md-4">
                                        <h5>Current Position</h5>
                                        <p class="mb-1">Salary: $<span id="currentSalary">75,000</span></p>
                                        <p class="mb-1">Percentile: <span id="currentPercentileValue">65.5%</span></p>
                                        <p class="mb-0">Market Position: <span id="marketPosition">Above Average</span></p>
                                    </div>
                                    <div class="col-md-4">
                                        <h5>Recommended Ranges</h5>
                                        <p class="mb-1">Conservative: $<span id="conservativeRange">86,250 - 90,000</span></p>
                                        <p class="mb-1">Optimal: $<span id="optimalRange">93,750 - 97,500</span></p>
                                        <p class="mb-0">Stretch: $<span id="stretchRange">101,250 - 112,500</span></p>
                                    </div>
                                    <div class="col-md-4">
                                        <h5>Potential Improvements</h5>
                                        <p class="mb-1">Conservative: +<span id="conservativeImprovement">15%</span></p>
                                        <p class="mb-1">Optimal: +<span id="optimalImprovement">27.5%</span></p>
                                        <p class="mb-0">Stretch: +<span id="stretchImprovement">42.5%</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Income Comparison Analysis -->
                    <div class="row mb-4" id="incomeComparisonSection" style="display: none;">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h4 class="mb-0">
                                        <i class="fas fa-chart-bar"></i> 
                                        Income Comparison Analysis
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <!-- Overall Summary -->
                                    <div class="row mb-4">
                                        <div class="col-md-3">
                                            <div class="metric-card">
                                                <div class="metric-value" id="overallPercentile">53.1%</div>
                                                <div class="metric-label">Overall Percentile</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="metric-card">
                                                <div class="metric-value" id="opportunityScore">27.2/100</div>
                                                <div class="metric-label">Career Opportunity Score</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="metric-card">
                                                <div class="metric-value" id="primaryGapAmount">$20,000</div>
                                                <div class="metric-label">Primary Income Gap</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="metric-card">
                                                <div class="metric-value" id="primaryGapGroup">College Grads</div>
                                                <div class="metric-label">vs. Primary Group</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Motivational Summary -->
                                    <div class="alert alert-info mb-4">
                                        <h5><i class="fas fa-lightbulb"></i> Your Career Opportunity</h5>
                                        <p id="motivationalSummary" class="mb-0">
                                            Your biggest opportunity is closing the $20,000 gap with College Graduates. 
                                            This represents significant career advancement potential that can transform your financial future.
                                        </p>
                                    </div>

                                    <!-- Detailed Comparisons -->
                                    <div class="row">
                                        <div class="col-md-8">
                                            <h5><i class="fas fa-list"></i> Detailed Comparisons</h5>
                                            <div id="comparisonDetails">
                                                <!-- Comparison items will be populated by JavaScript -->
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="action-plan">
                                                <h6><i class="fas fa-clipboard-list"></i> Action Plan</h6>
                                                <div id="incomeActionPlan">
                                                    <!-- Action plan items will be populated by JavaScript -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Job Opportunities -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3 class="mb-4"><i class="fas fa-briefcase"></i> Recommended Opportunities</h3>
                        </div>
                    </div>

                    <!-- Conservative Opportunity -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card opportunity-card conservative">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h4 class="card-title">
                                                    <i class="fas fa-shield-alt text-success"></i>
                                                    Conservative Opportunity
                                                </h4>
                                                <div class="success-probability high-probability" id="conservativeProbability">
                                                    85%
                                                </div>
                                            </div>
                                            <h5 class="card-subtitle mb-2" id="conservativeTitle">Senior Data Analyst</h5>
                                            <p class="card-text">
                                                <span class="company-badge" id="conservativeCompany">Fortune 500 Company</span>
                                                <span class="location-badge" id="conservativeLocation">Atlanta, GA</span>
                                            </p>
                                            <div class="salary-badge mb-3">
                                                $<span id="conservativeSalary">86,250 - 90,000</span> / year
                                            </div>
                                            <div class="mb-3">
                                                <strong>Why this opportunity:</strong>
                                                <p id="conservativeReasoning" class="mb-0">
                                                    Strong match with your current skills and experience level. 
                                                    Established company with stable growth opportunities.
                                                </p>
                                            </div>
                                            <div class="skill-gap">
                                                <strong>Skill Gap Analysis:</strong>
                                                <div id="conservativeSkills">
                                                    <span class="skill-tag">Python</span>
                                                    <span class="skill-tag">SQL</span>
                                                    <span class="skill-tag missing">Advanced ML</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="action-plan">
                                                <h6><i class="fas fa-clipboard-list"></i> Action Plan</h6>
                                                <div class="timeline-item">
                                                    <strong>Week 1-2:</strong> Apply and follow up
                                                </div>
                                                <div class="timeline-item">
                                                    <strong>Week 3-4:</strong> Prepare for interviews
                                                </div>
                                                <div class="timeline-item">
                                                    <strong>Month 2:</strong> Complete skill development
                                                </div>
                                                <button class="btn btn-success btn-action w-100 mb-2 btn-cta btn-primary">
                                                    <i class="fas fa-paper-plane"></i> Apply Now
                                                </button>
                                                <button class="btn btn-outline-primary btn-action w-100 btn-cta btn-primary">
                                                    <i class="fas fa-info-circle"></i> View Details
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Optimal Opportunity -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card opportunity-card optimal">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h4 class="card-title">
                                                    <i class="fas fa-star text-primary"></i>
                                                    Optimal Opportunity
                                                </h4>
                                                <div class="success-probability medium-probability" id="optimalProbability">
                                                    65%
                                                </div>
                                            </div>
                                            <h5 class="card-subtitle mb-2" id="optimalTitle">Lead Data Scientist</h5>
                                            <p class="card-text">
                                                <span class="company-badge" id="optimalCompany">Growth Tech Company</span>
                                                <span class="location-badge" id="optimalLocation">Houston, TX</span>
                                            </p>
                                            <div class="salary-badge mb-3">
                                                $<span id="optimalSalary">93,750 - 97,500</span> / year
                                            </div>
                                            <div class="mb-3">
                                                <strong>Why this opportunity:</strong>
                                                <p id="optimalReasoning" class="mb-0">
                                                    Perfect balance of growth potential and achievable requirements. 
                                                    Leadership opportunities and skill development.
                                                </p>
                                            </div>
                                            <div class="skill-gap">
                                                <strong>Skill Gap Analysis:</strong>
                                                <div id="optimalSkills">
                                                    <span class="skill-tag">Python</span>
                                                    <span class="skill-tag">Machine Learning</span>
                                                    <span class="skill-tag missing">Team Leadership</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="action-plan">
                                                <h6><i class="fas fa-clipboard-list"></i> Action Plan</h6>
                                                <div class="timeline-item">
                                                    <strong>Week 1-2:</strong> Skill development
                                                </div>
                                                <div class="timeline-item">
                                                    <strong>Week 3-4:</strong> Network and apply
                                                </div>
                                                <div class="timeline-item">
                                                    <strong>Month 2-3:</strong> Interview preparation
                                                </div>
                                                <button class="btn btn-primary btn-action w-100 mb-2 btn-cta btn-primary">
                                                    <i class="fas fa-paper-plane"></i> Apply Now
                                                </button>
                                                <button class="btn btn-outline-primary btn-action w-100 btn-cta btn-primary">
                                                    <i class="fas fa-info-circle"></i> View Details
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stretch Opportunity -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card opportunity-card stretch">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h4 class="card-title">
                                                    <i class="fas fa-rocket text-danger"></i>
                                                    Stretch Opportunity
                                                </h4>
                                                <div class="success-probability low-probability" id="stretchProbability">
                                                    45%
                                                </div>
                                            </div>
                                            <h5 class="card-subtitle mb-2" id="stretchTitle">Senior ML Engineer</h5>
                                            <p class="card-text">
                                                <span class="company-badge" id="stretchCompany">AI Startup</span>
                                                <span class="location-badge" id="stretchLocation">San Francisco, CA</span>
                                            </p>
                                            <div class="salary-badge mb-3">
                                                $<span id="stretchSalary">101,250 - 112,500</span> / year
                                            </div>
                                            <div class="mb-3">
                                                <strong>Why this opportunity:</strong>
                                                <p id="stretchReasoning" class="mb-0">
                                                    High-growth potential with significant skill development required. 
                                                    Cutting-edge technology and equity opportunities.
                                                </p>
                                            </div>
                                            <div class="skill-gap">
                                                <strong>Skill Gap Analysis:</strong>
                                                <div id="stretchSkills">
                                                    <span class="skill-tag">Python</span>
                                                    <span class="skill-tag missing">Deep Learning</span>
                                                    <span class="skill-tag missing">System Design</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="action-plan">
                                                <h6><i class="fas fa-clipboard-list"></i> Action Plan</h6>
                                                <div class="timeline-item">
                                                    <strong>Month 1-2:</strong> Intensive skill development
                                                </div>
                                                <div class="timeline-item">
                                                    <strong>Month 3:</strong> Build portfolio projects
                                                </div>
                                                <div class="timeline-item">
                                                    <strong>Month 4-6:</strong> Apply and interview
                                                </div>
                                                <button class="btn btn-danger btn-action w-100 mb-2 btn-cta btn-primary">
                                                    <i class="fas fa-paper-plane"></i> Apply Now
                                                </button>
                                                <button class="btn btn-outline-primary btn-action w-100 btn-cta btn-primary">
                                                    <i class="fas fa-info-circle"></i> View Details
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comprehensive Action Plan -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="action-plan">
                                <h4><i class="fas fa-roadmap"></i> Comprehensive Action Plan</h4>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5><i class="fas fa-bolt"></i> Immediate Actions</h5>
                                        <ul class="list-unstyled">
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> Apply to Conservative opportunity</li>
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> Update LinkedIn profile</li>
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> Begin skill development for Optimal opportunity</li>
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> Start networking for Stretch opportunity</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h5><i class="fas fa-graduation-cap"></i> Skill Development</h5>
                                        <div class="mb-3">
                                            <strong>Priority Skills:</strong>
                                            <div class="mt-2">
                                                <span class="skill-tag">Machine Learning</span>
                                                <span class="skill-tag">Leadership</span>
                                                <span class="skill-tag">System Design</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Learning Resources:</strong>
                                            <ul class="list-unstyled">
                                                <li><i class="fas fa-link"></i> Coursera ML Specialization</li>
                                                <li><i class="fas fa-link"></i> Leadership workshops</li>
                                                <li><i class="fas fa-link"></i> System design practice</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-4">
                                    <div class="col-12">
                                        <h5><i class="fas fa-calendar-alt"></i> Timeline</h5>
                                        <div class="timeline-item">
                                            <strong>Week 1-2:</strong> Apply to Conservative opportunity, update profiles
                                        </div>
                                        <div class="timeline-item">
                                            <strong>Week 3-4:</strong> Begin skill development, network for Optimal opportunity
                                        </div>
                                        <div class="timeline-item">
                                            <strong>Month 2-3:</strong> Apply to Optimal opportunity, continue skill development
                                        </div>
                                        <div class="timeline-item">
                                            <strong>Month 4-6:</strong> Apply to Stretch opportunity, complete advanced training
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Success Metrics -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="action-plan">
                                <h4><i class="fas fa-chart-bar"></i> Success Metrics</h4>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value">85%</div>
                                            <div class="metric-label">Conservative Success Rate</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value">65%</div>
                                            <div class="metric-label">Optimal Success Rate</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value">45%</div>
                                            <div class="metric-label">Stretch Success Rate</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card">
                                            <div class="metric-value">27.5%</div>
                                            <div class="metric-label">Average Salary Increase</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="row mb-4">
                        <div class="col-12 text-center">
                            <button class="btn btn-primary btn-lg me-3 btn-cta btn-primary" onclick="downloadReport()">
                                <i class="fas fa-download"></i> Download Report
                            </button>
                            <button class="btn btn-success btn-lg me-3 btn-cta btn-primary" onclick="scheduleFollowUp()">
                                <i class="fas fa-calendar-plus"></i> Schedule Follow-up
                            </button>
                            <button class="btn btn-info btn-lg btn-cta btn-primary" onclick="shareResults()">
                                <i class="fas fa-share"></i> Share Results
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let sessionId = null;
        let resultsData = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // Get session ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            sessionId = urlParams.get('session_id') || getSessionIdFromPath();
            
            if (sessionId) {
                loadResults();
            } else {
                showError('No session ID provided');
            }
        }

        function getSessionIdFromPath() {
            const pathParts = window.location.pathname.split('/');
            return pathParts[pathParts.length - 1];
        }

        async function loadResults() {
            try {
                const response = await fetch(`/api/enhanced-recommendations/results/${sessionId}`, {
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });

                const result = await response.json();
                if (result.success) {
                    resultsData = result.data;
                    displayResults(result.data);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error loading results:', error);
                showError('Error loading results');
            }
        }

        function displayResults(data) {
            // Display user profile
            displayUserProfile(data.user_profile);
            
            // Display financial impact
            displayFinancialImpact(data.financial_impact);
            
            // Display income comparison if available
            if (data.financial_impact && data.financial_impact.income_comparison) {
                displayIncomeComparison(data.financial_impact.income_comparison);
            }
            
            // Display career strategy
            displayCareerStrategy(data.career_strategy);
            
            // Display action plan
            displayActionPlan(data.action_plan);
        }

        function displayUserProfile(userProfile) {
            document.getElementById('fieldExpertise').textContent = userProfile.field_expertise.primary_field;
            document.getElementById('experienceLevel').textContent = userProfile.experience_level;
            document.getElementById('currentPercentile').textContent = 
                Math.round(userProfile.income_position.percentile) + '%';
            document.getElementById('leadershipPotential').textContent = 
                Math.round(userProfile.leadership_potential * 100) + '%';
        }

        function displayFinancialImpact(financialImpact) {
            document.getElementById('currentSalary').textContent = 
                financialImpact.current_salary.toLocaleString();
            document.getElementById('currentPercentileValue').textContent = 
                financialImpact.current_percentile.toFixed(1) + '%';
            
            const conservativeRange = financialImpact.recommended_salary_ranges.conservative;
            document.getElementById('conservativeRange').textContent = 
                `${conservativeRange.min.toLocaleString()} - ${conservativeRange.max.toLocaleString()}`;
            
            const optimalRange = financialImpact.recommended_salary_ranges.optimal;
            document.getElementById('optimalRange').textContent = 
                `${optimalRange.min.toLocaleString()} - ${optimalRange.max.toLocaleString()}`;
            
            const stretchRange = financialImpact.recommended_salary_ranges.stretch;
            document.getElementById('stretchRange').textContent = 
                `${stretchRange.min.toLocaleString()} - ${stretchRange.max.toLocaleString()}`;
            
            // Calculate improvements
            const currentSalary = financialImpact.current_salary;
            document.getElementById('conservativeImprovement').textContent = 
                Math.round((conservativeRange.target - currentSalary) / currentSalary * 100) + '%';
            document.getElementById('optimalImprovement').textContent = 
                Math.round((optimalRange.target - currentSalary) / currentSalary * 100) + '%';
            document.getElementById('stretchImprovement').textContent = 
                Math.round((stretchRange.target - currentSalary) / currentSalary * 100) + '%';
        }

        function displayCareerStrategy(careerStrategy) {
            // Conservative opportunity
            const conservative = careerStrategy.conservative_opportunity;
            document.getElementById('conservativeTitle').textContent = conservative.job.title;
            document.getElementById('conservativeCompany').textContent = conservative.job.company;
            document.getElementById('conservativeLocation').textContent = conservative.job.location;
            document.getElementById('conservativeSalary').textContent = 
                `${conservative.job.salary_range.min.toLocaleString()} - ${conservative.job.salary_range.max.toLocaleString()}`;
            document.getElementById('conservativeReasoning').textContent = conservative.selection_reasoning;
            document.getElementById('conservativeProbability').textContent = 
                Math.round(conservative.application_strategy.success_probability * 100) + '%';
            
            // Optimal opportunity
            const optimal = careerStrategy.optimal_opportunity;
            document.getElementById('optimalTitle').textContent = optimal.job.title;
            document.getElementById('optimalCompany').textContent = optimal.job.company;
            document.getElementById('optimalLocation').textContent = optimal.job.location;
            document.getElementById('optimalSalary').textContent = 
                `${optimal.job.salary_range.min.toLocaleString()} - ${optimal.job.salary_range.max.toLocaleString()}`;
            document.getElementById('optimalReasoning').textContent = optimal.selection_reasoning;
            document.getElementById('optimalProbability').textContent = 
                Math.round(optimal.application_strategy.success_probability * 100) + '%';
            
            // Stretch opportunity
            const stretch = careerStrategy.stretch_opportunity;
            document.getElementById('stretchTitle').textContent = stretch.job.title;
            document.getElementById('stretchCompany').textContent = stretch.job.company;
            document.getElementById('stretchLocation').textContent = stretch.job.location;
            document.getElementById('stretchSalary').textContent = 
                `${stretch.job.salary_range.min.toLocaleString()} - ${stretch.job.salary_range.max.toLocaleString()}`;
            document.getElementById('stretchReasoning').textContent = stretch.selection_reasoning;
            document.getElementById('stretchProbability').textContent = 
                Math.round(stretch.application_strategy.success_probability * 100) + '%';
        }

        function displayActionPlan(actionPlan) {
            // Action plan is already displayed in the template
            // Additional customization can be added here
        }

        function displayIncomeComparison(incomeComparison) {
            // Show the income comparison section
            document.getElementById('incomeComparisonSection').style.display = 'block';
            
            // Update overall metrics
            document.getElementById('overallPercentile').textContent = 
                incomeComparison.overall_percentile.toFixed(1) + '%';
            document.getElementById('opportunityScore').textContent = 
                incomeComparison.career_opportunity_score.toFixed(1) + '/100';
            
            // Update primary gap information
            const primaryGap = incomeComparison.primary_gap;
            const gapAmount = Math.abs(primaryGap.income_gap);
            document.getElementById('primaryGapAmount').textContent = 
                '$' + gapAmount.toLocaleString();
            document.getElementById('primaryGapGroup').textContent = 
                primaryGap.group_name;
            
            // Update motivational summary
            document.getElementById('motivationalSummary').textContent = 
                incomeComparison.motivational_summary;
            
            // Display detailed comparisons
            displayComparisonDetails(incomeComparison.comparisons);
            
            // Display action plan
            displayIncomeActionPlan(incomeComparison.action_plan);
        }

        function displayComparisonDetails(comparisons) {
            const container = document.getElementById('comparisonDetails');
            container.innerHTML = '';
            
            comparisons.forEach((comparison, index) => {
                const gapSign = comparison.income_gap >= 0 ? '+' : '';
                const gapClass = comparison.income_gap >= 0 ? 'text-danger' : 'text-success';
                
                const comparisonDiv = document.createElement('div');
                comparisonDiv.className = 'card mb-3';
                comparisonDiv.innerHTML = `
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6 class="card-title">${comparison.group_name}</h6>
                                <p class="mb-1">Median: $${comparison.median_income.toLocaleString()}</p>
                                <p class="mb-0">Your Percentile: ${comparison.percentile_rank.toFixed(1)}%</p>
                            </div>
                            <div class="col-md-4">
                                <p class="mb-1">
                                    <strong class="${gapClass}">
                                        ${gapSign}$${Math.abs(comparison.income_gap).toLocaleString()}
                                    </strong>
                                    <span class="text-muted">(${gapSign}${comparison.gap_percentage.toFixed(1)}%)</span>
                                </p>
                                <small class="text-muted">${comparison.context_message}</small>
                            </div>
                            <div class="col-md-4">
                                <p class="mb-1"><strong>Insight:</strong></p>
                                <small>${comparison.motivational_insight}</small>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(comparisonDiv);
            });
        }

        function displayIncomeActionPlan(actionPlan) {
            const container = document.getElementById('incomeActionPlan');
            container.innerHTML = '';
            
            actionPlan.forEach((action, index) => {
                const actionDiv = document.createElement('div');
                actionDiv.className = 'timeline-item';
                actionDiv.innerHTML = `
                    <strong>Step ${index + 1}:</strong> ${action}
                `;
                container.appendChild(actionDiv);
            });
        }

        function downloadReport() {
            if (!resultsData) {
                showError('No results data available');
                return;
            }
            
            // Create downloadable report
            const report = generateReport(resultsData);
            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `job-recommendations-${sessionId}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function generateReport(data) {
            let report = 'JOB RECOMMENDATIONS REPORT\n';
            report += '========================\n\n';
            
            report += `Generated: ${new Date().toLocaleString()}\n`;
            report += `Session ID: ${sessionId}\n\n`;
            
            report += 'USER PROFILE\n';
            report += '============\n';
            report += `Field: ${data.user_profile.field_expertise.primary_field}\n`;
            report += `Experience Level: ${data.user_profile.experience_level}\n`;
            report += `Current Salary: $${data.financial_impact.current_salary.toLocaleString()}\n`;
            report += `Current Percentile: ${data.financial_impact.current_percentile.toFixed(1)}%\n\n`;
            
            report += 'RECOMMENDED OPPORTUNITIES\n';
            report += '========================\n\n';
            
            // Conservative
            const conservative = data.career_strategy.conservative_opportunity;
            report += '1. CONSERVATIVE OPPORTUNITY\n';
            report += `   Title: ${conservative.job.title}\n`;
            report += `   Company: ${conservative.job.company}\n`;
            report += `   Location: ${conservative.job.location}\n`;
            report += `   Salary: $${conservative.job.salary_range.min.toLocaleString()} - $${conservative.job.salary_range.max.toLocaleString()}\n`;
            report += `   Success Probability: ${Math.round(conservative.application_strategy.success_probability * 100)}%\n\n`;
            
            // Optimal
            const optimal = data.career_strategy.optimal_opportunity;
            report += '2. OPTIMAL OPPORTUNITY\n';
            report += `   Title: ${optimal.job.title}\n`;
            report += `   Company: ${optimal.job.company}\n`;
            report += `   Location: ${optimal.job.location}\n`;
            report += `   Salary: $${optimal.job.salary_range.min.toLocaleString()} - $${optimal.job.salary_range.max.toLocaleString()}\n`;
            report += `   Success Probability: ${Math.round(optimal.application_strategy.success_probability * 100)}%\n\n`;
            
            // Stretch
            const stretch = data.career_strategy.stretch_opportunity;
            report += '3. STRETCH OPPORTUNITY\n';
            report += `   Title: ${stretch.job.title}\n`;
            report += `   Company: ${stretch.job.company}\n`;
            report += `   Location: ${stretch.job.location}\n`;
            report += `   Salary: $${stretch.job.salary_range.min.toLocaleString()} - $${stretch.job.salary_range.max.toLocaleString()}\n`;
            report += `   Success Probability: ${Math.round(stretch.application_strategy.success_probability * 100)}%\n\n`;
            
            return report;
        }

        function scheduleFollowUp() {
            // Implement follow-up scheduling
            alert('Follow-up scheduling feature coming soon!');
        }

        function shareResults() {
            // Implement results sharing
            if (navigator.share) {
                navigator.share({
                    title: 'My Job Recommendations',
                    text: 'Check out my personalized job recommendations from Mingus!',
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        function showError(message) {
            // Create error alert
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                ${message}
                <button type="button" class="btn-close btn-cta btn-primary" data-bs-dismiss="alert"></button>
            `;

            // Insert at top of page
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
        }

        function getAuthToken() {
            // Get auth token from localStorage or cookies
            return localStorage.getItem('authToken') || '';
        }
    </script>
</body>
</html> 