<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="touch_target_optimization.css">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Health Assessment - Mingus</title>
  <link rel="stylesheet" href="/static/css/form.css">
  <style>
    .questionnaire-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    
    .header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 0.5rem;
    }
    
    .header p {
      color: #6b7280;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    .progress-container {
      margin-bottom: 2rem;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2563eb, #3b82f6);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .progress-text {
      text-align: center;
      margin-top: 0.5rem;
      color: #6b7280;
      font-size: 0.9rem;
    }
    
    .questionnaire-form {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .question-section {
      margin-bottom: 2.5rem;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
    }
    
    .question-section:nth-child(1) { animation-delay: 0.1s; }
    .question-section:nth-child(2) { animation-delay: 0.2s; }
    .question-section:nth-child(3) { animation-delay: 0.3s; }
    .question-section:nth-child(4) { animation-delay: 0.4s; }
    .question-section:nth-child(5) { animation-delay: 0.5s; }
    .question-section:nth-child(6) { animation-delay: 0.6s; }
    
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .section-icon {
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: white;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #374151;
    }
    
    .form-input,
    .form-select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .range-container {
      position: relative;
      padding: 1rem 0;
    }
    
    .range-slider {
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    
    .range-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #2563eb;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .range-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #6b7280;
    }
    
    .range-value {
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #2563eb;
      margin-top: 0.5rem;
    }
    
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .checkbox-item:hover {
      border-color: #2563eb;
      background: #f8fafc;
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #2563eb;
    }
    
    .submit-container {
      text-align: center;
      margin-top: 3rem;
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      border: none;
      padding: 1rem 3rem;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 12px -1px rgba(37, 99, 235, 0.3);
    }
    
    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .error-message {
      color: #dc2626;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      display: none;
    }
    
    .form-input.error,
    .form-select.error {
      border-color: #dc2626;
    }
    
    .success-message {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 2rem;
      text-align: center;
      color: #166534;
      display: none;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .questionnaire-container {
        padding: 1rem;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .questionnaire-form {
        padding: 1.5rem;
      }
      
      .checkbox-group {
        grid-template-columns: 1fr;
      }
      
      .submit-btn {
        width: 100%;
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="questionnaire-container">
    <!-- Header -->
    <div class="header">
      <h1>Financial Health Assessment</h1>
      <p>Quick assessment to understand your financial situation and provide personalized recommendations</p>
    </div>

    <!-- Progress indicator -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0% Complete</div>
    </div>

    <!-- Success message -->
    <div class="success-message" id="successMessage">
      <strong>‚úÖ Assessment submitted successfully!</strong><br>
      Your financial health score and personalized recommendations are being generated.
    </div>

    <!-- Financial Questionnaire Form -->
    <form class="questionnaire-form" id="financialQuestionnaireForm">
      <!-- Income Section -->
      <div class="question-section">
        <div class="section-title">
          <div class="section-icon">üí∞</div>
          Income
        </div>
        
        <div class="form-group">
          <label class="form-label" for="monthly_income">
            What's your approximate monthly income? (before taxes)
          </label>
          <input 
            type="number" 
            id="monthly_income" 
            name="monthly_income"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 5000"
            required
          >
          <div class="error-message" id="monthlyIncomeError"></div>
        </div>
      </div>

      <!-- Expenses Section -->
      <div class="question-section">
        <div class="section-title">
          <div class="section-icon">üìä</div>
          Monthly Expenses
        </div>
        
        <div class="form-group">
          <label class="form-label" for="monthly_expenses">
            What are your total monthly expenses? (rent, bills, food, etc.)
          </label>
          <input 
            type="number" 
            id="monthly_expenses" 
            name="monthly_expenses"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 3000"
            required
          >
          <div class="error-message" id="monthlyExpensesError"></div>
        </div>
      </div>

      <!-- Savings Section -->
      <div class="question-section">
        <div class="section-title">
          <div class="section-icon">üè¶</div>
          Savings & Emergency Fund
        </div>
        
        <div class="form-group">
          <label class="form-label" for="current_savings">
            How much do you currently have in savings?
          </label>
          <input 
            type="number" 
            id="current_savings" 
            name="current_savings"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 10000"
            required
          >
          <div class="error-message" id="currentSavingsError"></div>
        </div>
      </div>

      <!-- Debt Section -->
      <div class="question-section">
        <div class="section-title">
          <div class="section-icon">üí≥</div>
          Debt
        </div>
        
        <div class="form-group">
          <label class="form-label" for="total_debt">
            What's your total debt? (credit cards, loans, etc.)
          </label>
          <input 
            type="number" 
            id="total_debt" 
            name="total_debt"
            class="form-input"
            min="0" 
            step="100"
            placeholder="e.g., 15000"
            required
          >
          <div class="error-message" id="totalDebtError"></div>
        </div>
      </div>

      <!-- Risk Tolerance Section -->
      <div class="question-section">
        <div class="section-title">
          <div class="section-icon">üéØ</div>
          Investment Risk Tolerance
        </div>
        
        <div class="form-group">
          <label class="form-label" for="risk_tolerance">
            How comfortable are you with investment risk?
          </label>
          <div class="range-container">
            <input 
              type="range" 
              id="risk_tolerance" 
              name="risk_tolerance"
              class="range-slider"
              min="1" 
              max="5" 
              value="3"
            >
            <div class="range-labels">
              <span>Conservative</span>
              <span>Aggressive</span>
            </div>
            <div class="range-value" id="riskToleranceValue">Moderate</div>
          </div>
          <div class="error-message" id="riskToleranceError"></div>
        </div>
      </div>

      <!-- Financial Goals Section -->
      <div class="question-section">
        <div class="section-title">
          <div class="section-icon">üéØ</div>
          Financial Goals
        </div>
        
        <div class="form-group">
          <label class="form-label">
            What are your main financial goals? (Select all that apply)
          </label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="goal_emergency" name="financial_goals" value="emergency_fund">
              <label for="goal_emergency">Build emergency fund</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_debt" name="financial_goals" value="debt_payoff">
              <label for="goal_debt">Pay off debt</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_savings" name="financial_goals" value="savings">
              <label for="goal_savings">Save for major purchase</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_investment" name="financial_goals" value="investment">
              <label for="goal_investment">Start investing</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_retirement" name="financial_goals" value="retirement">
              <label for="goal_retirement">Plan for retirement</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="goal_home" name="financial_goals" value="home_purchase">
              <label for="goal_home">Buy a home</label>
            </div>
          </div>
          <div class="error-message" id="financialGoalsError"></div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="submit-container">
        <button type="submit" class="submit-btn btn-cta btn-primary" id="submitBtn">
          <span class="loading" id="loadingSpinner" style="display: none;"></span>
          Get My Financial Health Score
        </button>
      </div>
    </form>
  </div>

  <script>
    class FinancialQuestionnaire {
      constructor() {
        this.form = document.getElementById('financialQuestionnaireForm');
        this.submitBtn = document.getElementById('submitBtn');
        this.loadingSpinner = document.getElementById('loadingSpinner');
        this.successMessage = document.getElementById('successMessage');
        this.progressFill = document.getElementById('progressFill');
        this.progressText = document.getElementById('progressText');
        
        this.initializeEventListeners();
        this.updateProgress();
      }

      initializeEventListeners() {
        // Form submission
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));

        // Range slider updates
        const rangeSlider = document.getElementById('risk_tolerance');
        rangeSlider.addEventListener('input', (e) => this.updateRangeValue(e));

        // Form field changes for progress tracking
        const formFields = this.form.querySelectorAll('input, select');
        formFields.forEach(field => {
          field.addEventListener('change', () => this.updateProgress());
          field.addEventListener('input', () => this.updateProgress());
        });

        // Real-time validation
        formFields.forEach(field => {
          field.addEventListener('blur', (e) => this.validateField(e.target));
        });
      }

      updateRangeValue(event) {
        const slider = event.target;
        const valueDisplay = document.getElementById('riskToleranceValue');
        const value = parseInt(slider.value);
        
        const labels = ['Very Conservative', 'Conservative', 'Moderate', 'Aggressive', 'Very Aggressive'];
        valueDisplay.textContent = labels[value - 1];
        
        this.updateProgress();
      }

      updateProgress() {
        const formFields = this.form.querySelectorAll('input[required], select[required]');
        const totalFields = formFields.length;
        let completedFields = 0;

        formFields.forEach(field => {
          if (field.type === 'checkbox') {
            // For checkboxes, check if at least one is selected
            const checkboxGroup = field.name;
            const checkboxes = this.form.querySelectorAll(`input[name="${checkboxGroup}"]:checked`);
            if (checkboxes.length > 0) {
              completedFields++;
            }
          } else if (field.value.trim() !== '') {
            completedFields++;
          }
        });

        const progress = totalFields > 0 ? (completedFields / totalFields) * 100 : 0;
        this.progressFill.style.width = `${progress}%`;
        this.progressText.textContent = `${Math.round(progress)}% Complete`;
      }

      validateField(field) {
        const errorElement = document.getElementById(field.id + 'Error');
        let isValid = true;
        let errorMessage = '';

        // Remove existing error styling
        field.classList.remove('error');
        if (errorElement) {
          errorElement.style.display = 'none';
        }

        // Validation rules
        if (field.hasAttribute('required') && field.value.trim() === '') {
          isValid = false;
          errorMessage = 'This field is required';
        } else if (field.type === 'number') {
          const value = parseFloat(field.value);
          if (field.value && value < 0) {
            isValid = false;
            errorMessage = 'Please enter a positive number';
          }
        }

        // Apply error styling and message
        if (!isValid) {
          field.classList.add('error');
          if (errorElement) {
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
          }
        }

        return isValid;
      }

      validateForm() {
        const formFields = this.form.querySelectorAll('input, select');
        let isValid = true;

        formFields.forEach(field => {
          if (!this.validateField(field)) {
            isValid = false;
          }
        });

        return isValid;
      }

      async handleSubmit(event) {
        event.preventDefault();

        if (!this.validateForm()) {
          return;
        }

        // Show loading state
        this.setLoadingState(true);

        try {
          const formData = new FormData(this.form);
          const data = Object.fromEntries(formData.entries());

          // Convert string values to appropriate types
          data.monthly_income = parseFloat(data.monthly_income) || 0;
          data.monthly_expenses = parseFloat(data.monthly_expenses) || 0;
          data.current_savings = parseFloat(data.current_savings) || 0;
          data.total_debt = parseFloat(data.total_debt) || 0;
          data.risk_tolerance = parseInt(data.risk_tolerance);

          // Handle checkbox groups
          data.financial_goals = Array.from(this.form.querySelectorAll('input[name="financial_goals"]:checked'))
            .map(checkbox => checkbox.value);

          const response = await fetch('/api/financial/questionnaire', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });

          if (response.ok) {
            this.showSuccess();
            // Redirect to results page after a short delay
            setTimeout(() => {
              window.location.href = '/api/financial/questionnaire/results';
            }, 2000);
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to submit questionnaire');
          }
        } catch (error) {
          console.error('Submission error:', error);
          alert('Failed to submit financial questionnaire. Please try again.');
        } finally {
          this.setLoadingState(false);
        }
      }

      setLoadingState(loading) {
        this.submitBtn.disabled = loading;
        this.loadingSpinner.style.display = loading ? 'inline-block' : 'none';
        this.submitBtn.innerHTML = loading 
          ? '<span class="loading" id="loadingSpinner"></span>Processing...'
          : 'Get My Financial Health Score';
      }

      showSuccess() {
        this.successMessage.style.display = 'block';
        this.form.style.display = 'none';
      }
    }

    // Initialize the questionnaire when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new FinancialQuestionnaire();
    });
  </script>
</body>
</html> 