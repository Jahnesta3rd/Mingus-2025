<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Profile - Mingus</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.31"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app" class="container">
        <div class="signup-form">
            <h1>Complete Your Profile</h1>
            <p class="subtitle">You're almost there! Let's make it official.</p>

            <!-- Error Alert -->
            <div v-if="error" class="alert alert-error">
                <p>[[ error ]]</p>
            </div>

            <!-- Success Message -->
            <div v-if="success" class="alert alert-success">
                <h3>[[ welcomeMessage ]]</h3>
                <p>Your account has been created successfully.</p>
                <a href="/dashboard" class="btn btn-primary">Go to Dashboard</a>
            </div>

            <!-- Signup Form -->
            <form v-if="!success" @submit.prevent="submitForm" class="form">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input 
                        type="text" 
                        id="fullName" 
                        v-model="formData.full_name"
                        :class="{'error': validationErrors.full_name}"
                        required
                        minlength="2"
                        maxlength="100"
                    >
                    <span v-if="validationErrors.full_name" class="error-text">
                        [[ validationErrors.full_name ]]
                    </span>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input 
                        type="email" 
                        id="email" 
                        v-model="formData.email"
                        :class="{'error': validationErrors.email}"
                        required
                    >
                    <span v-if="validationErrors.email" class="error-text">
                        [[ validationErrors.email ]]
                    </span>
                </div>

                <div class="form-group">
                    <label for="incomeRange">Income Range</label>
                    <select 
                        id="incomeRange" 
                        v-model="formData.income_range"
                        :class="{'error': validationErrors.income_range}"
                        required
                    >
                        <option value="">Select Income Range</option>
                        <option value="under_25k">Under $25,000</option>
                        <option value="25k_50k">$25,000 - $50,000</option>
                        <option value="50k_75k">$50,000 - $75,000</option>
                        <option value="75k_100k">$75,000 - $100,000</option>
                        <option value="100k_150k">$100,000 - $150,000</option>
                        <option value="150k_200k">$150,000 - $200,000</option>
                        <option value="over_200k">Over $200,000</option>
                    </select>
                    <span v-if="validationErrors.income_range" class="error-text">
                        [[ validationErrors.income_range ]]
                    </span>
                </div>

                <button type="submit" class="btn btn-primary" :disabled="loading">
                    <span v-if="loading">Creating Account...</span>
                    <span v-else>Complete Signup</span>
                </button>
            </form>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            delimiters: ['[[', ']]'],
            data() {
                return {
                    formData: {
                        full_name: '',
                        email: '',
                        income_range: '',
                        session_id: '{{ session_id }}'
                    },
                    validationErrors: {},
                    error: null,
                    success: false,
                    loading: false,
                    welcomeMessage: ''
                }
            },
            methods: {
                validateForm() {
                    this.validationErrors = {}
                    
                    if (!this.formData.full_name || this.formData.full_name.length < 2) {
                        this.validationErrors.full_name = 'Name must be at least 2 characters long'
                    }
                    
                    if (!this.formData.email || !this.formData.email.match(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/)) {
                        this.validationErrors.email = 'Please enter a valid email address'
                    }
                    
                    if (!this.formData.income_range) {
                        this.validationErrors.income_range = 'Please select your income range'
                    }
                    
                    return Object.keys(this.validationErrors).length === 0
                },
                async submitForm() {
                    if (!this.validateForm()) {
                        return
                    }
                    
                    this.loading = true
                    this.error = null
                    
                    try {
                        const response = await axios.post('/api/signup', this.formData)
                        this.success = true
                        this.welcomeMessage = response.data.welcome_message
                    } catch (error) {
                        if (error.response && error.response.data && error.response.data.error) {
                            this.error = error.response.data.error
                        } else {
                            this.error = 'An unexpected error occurred. Please try again.'
                        }
                    } finally {
                        this.loading = false
                    }
                }
            }
        }).mount('#app')
    </script>

    <style>
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .signup-form {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: #666;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        input.error, select.error {
            border-color: #dc3545;
        }

        .error-text {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: block;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: #007bff;
            color: #fff;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            text-align: center;
        }

        .alert-success h3 {
            margin-bottom: 1rem;
        }
    </style>
</body>
</html> 