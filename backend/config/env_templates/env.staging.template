# ============================================================================
# MINGUS Email Verification System - Staging Environment
# ============================================================================
# 
# This template contains staging environment settings that balance
# testing needs with security requirements.
# 
# Staging uses moderate security settings between development and production
# 
# Copy this file to .env.staging and customize as needed.
# ============================================================================

# ============================================================================
# FLASK ENVIRONMENT CONFIGURATION
# ============================================================================
FLASK_ENV=staging
FLASK_DEBUG=false
FLASK_SECRET_KEY=staging-secret-key-change-for-production

# ============================================================================
# EMAIL VERIFICATION TOKEN SECURITY (STAGING)
# ============================================================================
# 
# Staging uses high security settings similar to production
# 
# EMAIL_VERIFICATION_SECRET: Cryptographically secure secret for HMAC token generation
# - Should be at least 64 characters long
# - Should be unique for staging environment
# - Generate using: python -c "import secrets; print(secrets.token_urlsafe(64))"
EMAIL_VERIFICATION_SECRET=REQUIRED: Generate a 64+ character random secret for staging

# EMAIL_VERIFICATION_TOKEN_LENGTH: Length of verification tokens in bytes
# - Staging: 64 bytes (512 bits) - high security
EMAIL_VERIFICATION_TOKEN_LENGTH=64

# EMAIL_VERIFICATION_EXPIRY_HOURS: How long tokens remain valid
# - Staging: 12 hours (shorter for testing, longer than development)
EMAIL_VERIFICATION_EXPIRY_HOURS=12

# EMAIL_VERIFICATION_MAX_TOKEN_AGE_HOURS: Maximum age before requiring regeneration
EMAIL_VERIFICATION_MAX_TOKEN_AGE_HOURS=24

# ============================================================================
# RATE LIMITING CONFIGURATION (STAGING)
# ============================================================================
# 
# Staging uses moderate rate limiting for testing
# 
# Maximum verification attempts per hour per IP address
EMAIL_VERIFICATION_MAX_ATTEMPTS_PER_HOUR=10

# Maximum verification attempts per hour per user
EMAIL_VERIFICATION_MAX_ATTEMPTS_PER_USER_HOUR=5

# Maximum resend attempts per day per user
EMAIL_VERIFICATION_MAX_RESEND_ATTEMPTS_PER_DAY=5

# Cooldown period between resend attempts (in hours)
EMAIL_VERIFICATION_RESEND_COOLDOWN_HOURS=1

# Maximum failed verification attempts before account lockout
EMAIL_VERIFICATION_MAX_FAILED_ATTEMPTS=5

# Account lockout duration after max failed attempts (in hours)
EMAIL_VERIFICATION_LOCKOUT_DURATION_HOURS=1

# ============================================================================
# EMAIL CONFIGURATION (STAGING)
# ============================================================================
# 
# Staging email settings with staging branding
# 
# Email service provider (inherits from existing Resend setup)
EMAIL_SERVICE_PROVIDER=resend

# Email template directory path
EMAIL_TEMPLATE_DIR=backend/templates

# Default sender email address (staging domain)
EMAIL_DEFAULT_FROM=noreply@staging.mingus.app

# Reply-to email address for support
EMAIL_REPLY_TO=support@staging.mingus.app

# Email subject line prefix (staging branding)
EMAIL_SUBJECT_PREFIX=[STAGING] Mingus - 

# Maximum email size in bytes (for template validation)
EMAIL_MAX_SIZE_BYTES=1048576

# ============================================================================
# REMINDER SYSTEM CONFIGURATION (STAGING)
# ============================================================================
# 
# Staging uses faster reminder schedule for testing
# 
# Enable automatic reminder system
EMAIL_VERIFICATION_ENABLE_REMINDERS=true

# Reminder schedule in days after signup (comma-separated)
# Staging: Fast schedule for testing (1,3,7 days)
EMAIL_VERIFICATION_REMINDER_SCHEDULE_DAYS=1,3,7

# Maximum reminders per user
EMAIL_VERIFICATION_MAX_REMINDERS_PER_USER=3

# ============================================================================
# AUDIT AND MONITORING CONFIGURATION (STAGING)
# ============================================================================
# 
# Staging uses comprehensive logging and monitoring
# 
# Enable comprehensive audit logging
EMAIL_VERIFICATION_ENABLE_AUDIT_LOGGING=true

# Audit log retention period in days (staging: moderate retention)
EMAIL_VERIFICATION_AUDIT_LOG_RETENTION_DAYS=30

# Enable performance monitoring
EMAIL_VERIFICATION_ENABLE_MONITORING=true

# Metrics collection interval in minutes (staging: moderate monitoring)
EMAIL_VERIFICATION_METRICS_INTERVAL_MINUTES=10

# ============================================================================
# INTEGRATION CONFIGURATION (STAGING)
# ============================================================================
# 
# Staging URLs and connection strings
# 
# Frontend URL for verification links
FRONTEND_URL=https://staging.mingus.app

# API base URL for verification endpoints
API_BASE_URL=https://api.staging.mingus.app

# Redis configuration for rate limiting
REDIS_URL=redis://localhost:6379/1

# Database connection string (inherits from existing config)
DATABASE_URL=postgresql://localhost:5432/mingus_staging

# Celery broker URL for background tasks
CELERY_BROKER_URL=redis://localhost:6379/2

# ============================================================================
# SECURITY CONFIGURATION (STAGING)
# ============================================================================
# 
# Staging uses moderate security tracking
# 
# Enable IP address tracking for security
EMAIL_VERIFICATION_TRACK_IP_ADDRESSES=true

# Enable User-Agent tracking for security
EMAIL_VERIFICATION_TRACK_USER_AGENTS=true

# Enable geolocation tracking (if available)
EMAIL_VERIFICATION_TRACK_GEO_LOCATION=false

# Maximum concurrent verification sessions per user
EMAIL_VERIFICATION_MAX_CONCURRENT_SESSIONS=3

# Session timeout in hours (staging: moderate timeout)
EMAIL_VERIFICATION_SESSION_TIMEOUT_HOURS=24

# ============================================================================
# STAGING TESTING SETTINGS
# ============================================================================
# 
# Staging-specific testing configurations
# 
# Enable debug mode (false for staging)
EMAIL_VERIFICATION_DEBUG=false

# Enable test mode (false for staging)
EMAIL_VERIFICATION_TEST_MODE=false

# Test email override (empty for staging)
EMAIL_VERIFICATION_TEST_EMAIL=

# Mock email service (false for staging)
EMAIL_VERIFICATION_MOCK_EMAIL_SERVICE=false

# ============================================================================
# EXISTING SERVICE INTEGRATION (STAGING)
# ============================================================================
# 
# These variables should already be set in your staging configuration
# 
# Resend API key (from existing email service configuration)
RESEND_API_KEY=REQUIRED: Set your staging Resend API key

# Database configuration (if using separate variables)
POSTGRES_DB=mingus_staging
POSTGRES_USER=REQUIRED: Set staging database user
POSTGRES_PASSWORD=REQUIRED: Set staging database password
POSTGRES_HOST=REQUIRED: Set staging database host
POSTGRES_PORT=5432

# Redis configuration (if using separate variables)
REDIS_HOST=REQUIRED: Set staging Redis host
REDIS_PORT=6379
REDIS_DB=1
REDIS_PASSWORD=REQUIRED: Set staging Redis password if applicable

# ============================================================================
# STAGING MONITORING AND ALERTING
# ============================================================================
# 
# Staging monitoring configuration
# 
# Enable health check endpoints
ENABLE_HEALTH_CHECKS=true

# Health check timeout in seconds
HEALTH_CHECK_TIMEOUT=30

# Enable performance profiling
ENABLE_PERFORMANCE_PROFILING=false

# Enable detailed error logging
ENABLE_DETAILED_ERROR_LOGGING=true

# ============================================================================
# STAGING DEPLOYMENT SETTINGS
# ============================================================================
# 
# Deployment-specific configurations for staging
# 
# Enable graceful shutdown
ENABLE_GRACEFUL_SHUTDOWN=true

# Graceful shutdown timeout in seconds
GRACEFUL_SHUTDOWN_TIMEOUT=30

# Enable connection pooling
ENABLE_CONNECTION_POOLING=true

# Database connection pool size
DB_POOL_SIZE=10

# Redis connection pool size
REDIS_POOL_SIZE=25

# ============================================================================
# STAGING TESTING CONFIGURATION
# ============================================================================
# 
# Staging-specific testing settings
# 
# Enable integration tests
ENABLE_INTEGRATION_TESTS=true

# Enable end-to-end tests
ENABLE_E2E_TESTS=true

# Test data cleanup interval (in hours)
TEST_DATA_CLEANUP_INTERVAL_HOURS=24

# Enable test user creation
ENABLE_TEST_USER_CREATION=true

# ============================================================================
# STAGING VALIDATION CHECKLIST
# ============================================================================
# 
# Before deploying to staging, verify:
# 
# 1. ✅ EMAIL_VERIFICATION_SECRET is set and at least 64 characters
# 2. ✅ All URLs use HTTPS
# 3. ✅ FLASK_DEBUG=false
# 4. ✅ EMAIL_VERIFICATION_DEBUG=false
# 5. ✅ EMAIL_VERIFICATION_TEST_MODE=false
# 6. ✅ EMAIL_VERIFICATION_MOCK_EMAIL_SERVICE=false
# 7. ✅ All required environment variables are set
# 8. ✅ Database and Redis connections are configured
# 9. ✅ Rate limiting is appropriately configured
# 10. ✅ Audit logging is enabled
# 11. ✅ Monitoring is enabled
# 12. ✅ IP and User-Agent tracking is enabled
# 
# ============================================================================
# 
# STAGING NOTES:
# - Use staging-specific domains and URLs
# - Configure staging database and Redis instances
# - Set up staging monitoring and alerting
# - Test all email verification flows
# - Validate rate limiting and security features
# - Ensure staging environment mirrors production closely
# 
# ============================================================================
